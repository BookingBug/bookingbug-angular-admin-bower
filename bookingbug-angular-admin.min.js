function SpaceMonitorCtrl($scope,$location){$scope.$on("Add_Space",function(event,message){console.log("got new space",message),$scope.$apply()})}(function(){"use strict";var adminapp;adminapp=angular.module("BBAdmin",["BB","BBAdmin.Services","BBAdmin.Filters","BBAdmin.Controllers","trNgGrid"]),angular.module("BBAdmin").config(function($logProvider){return $logProvider.debugEnabled(!0)}),angular.module("BBAdmin.Directives",[]),angular.module("BBAdmin.Filters",[]),angular.module("BBAdmin.Services",["ngResource","ngSanitize","ngLocalData"]),angular.module("BBAdmin.Controllers",["ngLocalData","ngSanitize"]),adminapp.run(function($rootScope,$log,DebugUtilsService,FormDataStoreService,$bbug,$document,$sessionStorage,AppConfig,AdminLoginService){return AdminLoginService.checkLogin().then(function(){return $rootScope.user&&$rootScope.user.company_id?($rootScope.bb||($rootScope.bb={}),$rootScope.bb.company_id=$rootScope.user.company_id):void 0})})}).call(this),function(){"use strict";angular.module("BBAdminMockE2E",["BBAdmin","ngMockE2E"]),angular.module("BBAdminMockE2E").run(function($httpBackend){var admin_schema,administrators,company,event_chain_schema,event_chains,member_bookings,member_schema,people,person_schema,schedule1,schedule_schema,schedules,service_schema,services;return $httpBackend.whenPOST("http://www.bookingbug.com/api/v1/login/admin/123").respond(function(method,url,data){var login;return console.log("login post"),login={email:"tennis@example.com",auth_token:"PO_MZmDtEhU1BK6tkMNPjg",company_id:123,path:"http://www.bookingbug.com/api/v1",role:"owner",_embedded:{members:[],administrators:[{role:"owner",name:"Tom's Tennis",company_id:123,_links:{self:{href:"http://www.bookingbug.com/api/v1/admin/123/administrator/29774"},company:{href:"http://www.bookingbug.com/api/v1/admin/123/company"},login:{href:"http://www.bookingbug.com/api/v1/login/admin/123"}}}]},_links:{self:{href:"http://www.bookingbug.com/api/v1/login/123"},administrator:{href:"http://www.bookingbug.com/api/v1/admin/123/administrator/29774",templated:!0}}},[200,login,{}]}),company={id:123,name:"Tom's Tennis",currency_code:"GBP",country_code:"gb",timezone:"Europe/London",_links:{self:{href:"http://www.bookingbug.com/api/v1/company/123"},people:{href:"http://www.bookingbug.com/api/v1/admin/123/people"},new_person:{href:"http://www.bookingbug.com/api/v1/admin/123/people/new{?signup}",templated:!0},administrators:{href:"http://www.bookingbug.com/api/v1/admin/123/administrators"},new_administrator:{href:"http://www.bookingbug.com/api/v1/admin/123/administrators/new"},services:{href:"http://www.bookingbug.com/api/v1/admin/123/services"},new_service:{href:"http://www.bookingbug.com/api/v1/admin/123/services/new"},event_chains:{href:"http://www.bookingbug.com/api/v1/admin/123/event_chains"},new_event_chain:{href:"http://www.bookingbug.com/api/v1/admin/123/event_chains/new"},schedules:{href:"http://www.bookingbug.com/api/v1/admin/123/schedules"},new_schedule:{href:"http://www.bookingbug.com/api/v1/admin/123/schedules/new"},resources:{href:"http://www.bookingbug.com/api/v1/admin/123/resources"},new_resource:{href:"http://www.bookingbug.com/api/v1/admin/123/resources/new"}}},$httpBackend.whenGET("http://www.bookingbug.com/api/v1/admin/123/company").respond(company),people={total_entries:3,_embedded:{people:[{id:1,name:"John",type:"person",deleted:!1,disabled:!1,company_id:123,mobile:"",_links:{self:{href:"http://www.bookingbug.com/api/v1/admin/123/people/1"},items:{href:"http://www.bookingbug.com/api/v1/123/items?person_id=1"},edit:{href:"http://www.bookingbug.com/api/v1/admin/123/people/1/edit"},schedule:{href:"http://www.bookingbug.com/api/v1/admin/123/schedules/1"}},_embedded:{}},{id:2,name:"Mary",type:"person",email:"mary@example.com",deleted:!1,disabled:!1,company_id:123,mobile:"",_links:{self:{href:"http://www.bookingbug.com/api/v1/admin/123/people/2"},items:{href:"http://www.bookingbug.com/api/v1/123/items?person_id=2"},edit:{href:"http://www.bookingbug.com/api/v1/admin/123/people/2/edit"},schedule:{href:"http://www.bookingbug.com/api/v1/admin/123/schedules/1"}},_embedded:{}},{id:3,name:"Bob",type:"person",email:"bob@example.com",deleted:!1,disabled:!1,company_id:123,mobile:"",_links:{self:{href:"http://www.bookingbug.com/api/v1/admin/123/people/3"},items:{href:"http://www.bookingbug.com/api/v1/123/items?person_id=3"},edit:{href:"http://www.bookingbug.com/api/v1/admin/123/people/3/edit"},schedule:{href:"http://www.bookingbug.com/api/v1/admin/123/schedules/1"}},_embedded:{}}]},_links:{self:{href:"http://www.bookingbug.com/api/v1/admin/123/people"},"new":{href:"http://www.bookingbug.com/api/v1/admin/123/people/new{?signup}",templated:!0}}},$httpBackend.whenGET("http://www.bookingbug.com/api/v1/admin/123/people").respond(people),person_schema={form:["*",{type:"submit",title:"Save"}],schema:{properties:{email:{title:"Email *",type:"string"},name:{title:"Name *",type:"string"},phone:{title:"Phone",type:"string"}},required:["name","email"],title:"Person",type:"object"}},$httpBackend.whenGET("http://www.bookingbug.com/api/v1/admin/123/people/new").respond(function(){return[200,person_schema,{}]}),$httpBackend.whenGET(/http:\/\/www.bookingbug.com\/api\/v1\/admin\/123\/people\/\d\/edit/).respond(function(){return[200,person_schema,{}]}),$httpBackend.whenDELETE(/http:\/\/www.bookingbug.com\/api\/v1\/admin\/123\/people\/\d/).respond(function(){return[200,{},{}]}),$httpBackend.whenPOST("http://www.bookingbug.com/api/v1/admin/123/people").respond(function(method,url,data){return console.log("post person"),console.log(method),console.log(url),console.log(data),[200,people.concat([data]),{}]}),services={total_entries:3,_embedded:{services:[{id:1,name:"Data analysis",type:"service",deleted:!1,disabled:!1,company_id:123,_links:{self:{href:"http://www.bookingbug.com/api/v1/admin/123/services/1"},edit:{href:"http://www.bookingbug.com/api/v1/admin/123/services/1/edit",templated:!0},items:{href:"http://www.bookingbug.com/api/v1/123/items?service_id=1"}},_embedded:{}},{id:2,name:"Personal consultation",type:"service",deleted:!1,disabled:!1,company_id:123,_links:{self:{href:"http://www.bookingbug.com/api/v1/admin/123/services/2"},edit:{href:"http://www.bookingbug.com/api/v1/admin/123/services/2/edit",templated:!0},items:{href:"http://www.bookingbug.com/api/v1/123/items?service_id=2"}},_embedded:{}},{id:3,name:"Marketing strategy",type:"service",deleted:!1,disabled:!1,company_id:123,_links:{self:{href:"http://www.bookingbug.com/api/v1/admin/123/services/3"},edit:{href:"http://www.bookingbug.com/api/v1/admin/123/services/3/edit",templated:!0},items:{href:"http://www.bookingbug.com/api/v1/123/items?service_id=3"}},_embedded:{}}]},_links:{self:{href:"http://www.bookingbug.com/api/v1/admin/123/services"},"new":{href:"http://www.bookingbug.com/api/v1/admin/123/services/new{?signup}",templated:!0}}},$httpBackend.whenGET("http://www.bookingbug.com/api/v1/admin/123/services").respond(services),service_schema={form:[{key:"name",type:"text",feedback:!1},{type:"submit",title:"Save"}],schema:{properties:{name:{title:"Name *",type:"String"}},required:["name"],title:"Service",type:"object"}},$httpBackend.whenGET("http://www.bookingbug.com/api/v1/admin/123/services/new").respond(function(){return[200,service_schema,{}]}),$httpBackend.whenGET("http://www.bookingbug.com/api/v1/admin/123/services/1/edit").respond(function(){return[200,service_schema,{}]}),$httpBackend.whenGET("http://www.bookingbug.com/api/v1/admin/123/services/2/edit").respond(function(){return[200,service_schema,{}]}),$httpBackend.whenGET("http://www.bookingbug.com/api/v1/admin/123/services/3/edit").respond(function(){return[200,service_schema,{}]}),$httpBackend.whenPOST("http://www.bookingbug.com/api/v1/admin/123/services").respond(function(method,url,data){return console.log("post service"),console.log(method),console.log(url),console.log(data),[200,services.concat([data]),{}]}),administrators={_embedded:{administrators:[{name:"Dave",email:"dave@example.com",role:"admin",company_id:123,company_name:"Tom's Tennis",_links:{self:{href:"http://www.bookingbug.com/api/v1/admin/123/administrators/1"},edit:{href:"http://www.bookingbug.com/api/v1/admin/123/administrators/1/edit"},company:{href:"http://www.bookingbug.com/api/v1/admin/123/company"},login:{href:"http://www.bookingbug.com/api/v1/login/admin/123"}}},{name:"Sue",email:"sue@example.com",role:"owner",company_id:123,company_name:"Tom's Tennis",_links:{self:{href:"http://www.bookingbug.com/api/v1/admin/123/administrators/2"},edit:{href:"http://www.bookingbug.com/api/v1/admin/123/administrators/2/edit"},company:{href:"http://www.bookingbug.com/api/v1/admin/123/company"},login:{href:"http://www.bookingbug.com/api/v1/login/admin/123"}}}]},_links:{self:{href:"http://www.bookingbug.com/api/v1/admin/123/administrators"},"new":{href:"http://www.bookingbug.com/api/v1/admin/123/administrators/new",templated:!0}}},$httpBackend.whenGET("http://www.bookingbug.com/api/v1/admin/123/administrators").respond(administrators),admin_schema={form:[{key:"name",type:"text",feedback:!1},{key:"email",type:"text",feedback:!1},{key:"role",type:"select",feedback:!1,titleMap:{owner:"Owner",admin:"Admin",user:"User"}},{type:"submit",title:"Save"}],schema:{properties:{name:{title:"Name *",type:"string"},email:{title:"Email *",type:"string"},role:{title:"Role",type:"string","enum":["owner","admin","user","callcenter"]}},required:["name","email"],title:"Administrator",type:"object"}},$httpBackend.whenGET("http://www.bookingbug.com/api/v1/admin/123/administrators/new").respond(function(){return[200,admin_schema,{}]}),admin_schema={form:[{key:"name",type:"text",feedback:!1},{key:"role",type:"select",feedback:!1,titleMap:{owner:"Owner",admin:"Admin",user:"User"}},{type:"submit",title:"Save"}],schema:{properties:{name:{title:"Name *",type:"string"},role:{title:"Role",type:"string","enum":["owner","admin","user","callcenter"]}},title:"Administrator",type:"object"}},$httpBackend.whenGET("http://www.bookingbug.com/api/v1/admin/123/administrators/1/edit").respond(function(){return[200,admin_schema,{}]}),$httpBackend.whenPOST("http://www.bookingbug.com/api/v1/login/member/123").respond(function(method,url,data){var login;return login={email:"smith@example.com",auth_token:"TO_4ZrDtEhU1BK6tkMNPj0",company_id:123,path:"http://www.bookingbug.com/api/v1",role:"member",_embedded:{members:[{first_name:"John",last_name:"Smith",email:"smith@example.com",client_type:"Member",address1:"Some street",address3:"Some town",id:123456,company_id:123,_links:{self:{href:"http://www.bookingbug.com/api/v1/123/members/123456{?embed}",templated:!0},bookings:{href:"http://www.bookingbug.com/api/v1/123/members/123456/bookings{?start_date,end_date,include_cancelled,page,per_page}",templated:!0},company:{href:"http://www.bookingbug.com/api/v1/company/123",templated:!0},edit_member:{href:"http://www.bookingbug.com/api/v1/123/members/123456/edit",templated:!0},pre_paid_bookings:{href:"http://www.bookingbug.com/api/v1/123/members/123456/pre_paid_bookings{?start_date,end_date,page,per_page}",templated:!0}}}],administrators:[]},_links:{self:{href:"http://www.bookingbug.com/api/v1/login/123"},member:{href:"http://www.bookingbug.com/api/v1/123/members/123456{?embed}",templated:!0}}},[200,login,{}]}),member_schema={form:[{key:"first_name",type:"text",feedback:!1},{key:"last_name",type:"text",feedback:!1},{key:"email",type:"email",feedback:!1},{key:"address1",type:"text",feedback:!1},{key:"address2",type:"text",feedback:!1},{key:"address3",type:"text",feedback:!1},{key:"address4",type:"text",feedback:!1},{key:"postcode",type:"text",feedback:!1},{type:"submit",title:"Save"}],schema:{properties:{first_name:{title:"First Name",type:"string"},last_name:{title:"Last Name",type:"string"},email:{title:"Email",type:"string"},address1:{title:"Address",type:"string"},address2:{title:" ",type:"string"},address3:{title:"Town",type:"string"},address4:{title:"County",type:"string"},postcode:{title:"Post Code",type:"string"}},title:"Member",type:"object"}},$httpBackend.whenGET("http://www.bookingbug.com/api/v1/123/members/123456/edit").respond(function(){return[200,member_schema,{}]}),member_bookings={_embedded:{bookings:[{_embedded:{answers:[{admin_only:!1,company_id:123,id:6700607,outcome:!1,price:0,question_id:20478,question_text:"Gender",value:"M"}]},_links:{company:{href:"http://www.bookingbug.com/api/v1/company/123"},edit_booking:{href:"http://www.bookingbug.com/api/v1/123/members/123456/bookings/4553463/edit"},member:{href:"http://www.bookingbug.com/api/v1/123/members/123456{?embed}",templated:!0},person:{href:"http://www.bookingbug.com/api/v1/123/people/74",templated:!0},self:{href:"http://www.bookingbug.com/api/v1/123/members/123456/bookings?start_date=2014-11-21&page=1&per_page=30"},service:{href:"http://www.bookingbug.com/api/v1/123/services/30063",templated:!0}},attended:!0,category_name:"Private Lessons",company_id:123,datetime:"2014-11-21T12:00:00+00:00",describe:"Fri 21st Nov 12:00pm",duration:3600,end_datetime:"2014-11-21T13:00:00+00:00",event_id:325562,full_describe:"Tennis Lesson",id:4553463,min_cancellation_time:"2014-11-20T12:00:00+00:00",on_waitlist:!1,paid:0,person_name:"Bob",price:1,purchase_id:3844035,purchase_ref:"j7PuYsmbexmFXS12Mzg0NDAzNQ%3D%3D",quantity:1,service_name:"Tennis Lesson",time_zone:""}]},_links:{self:{href:"http://www.bookingbug.com/api/v1/123/members/123456/bookings?start_date=2014-11-21&page=1&per_page=30"}},total_entries:1},$httpBackend.whenGET("http://www.bookingbug.com/api/v1/123/members/123456/bookings?start_date="+moment().format("YYYY-MM-DD")).respond(function(){return[200,member_bookings,{}]}),event_chains={total_entries:1,_embedded:{event_chains:[{id:1,deleted:!1,disabled:!1,company_id:123,capacity_view:3,description:"",duration:120,email_per_ticket:!0,end_date:"2015-11-12",group:"Events",long_description:"",max_num_bookings:1,min_advance_time:"2015-02-13T14:24:29+00:00",name:"My Event",person_name:"Ed",price:0,questions_per_ticket:!1,spaces:10,start_date:"2015-11-12",ticket_type:"single_space",time:"12:00:00+00:00",mobile:"",_links:{self:{href:"http://www.bookingbug.com/api/v1/admin/123/event_chains/1"},edit:{href:"http://www.bookingbug.com/api/v1/admin/123/event_chains/1/edit"}},_embedded:{}}]},_links:{self:{href:"http://www.bookingbug.com/api/v1/admin/123/event_chains"},"new":{href:"http://www.bookingbug.com/api/v1/admin/123/event_chains/new",templated:!0}}},$httpBackend.whenGET("http://www.bookingbug.com/api/v1/admin/123/event_chains").respond(event_chains),event_chain_schema={form:[{key:"name",type:"text",feedback:!1},{key:"description",type:"text",feedback:!1},{key:"spaces",type:"number",feedback:!1},{key:"events",feedback:!1,add:"New Event",style:{add:"btn-success"},items:[{key:"events[].date",type:"date",feedback:!1},{key:"events[].time",type:"time",feedback:!1},{key:"events[].duration",type:"number",feedback:!1}]},{type:"submit",title:"Save"}],schema:{properties:{name:{title:"Name *",type:"string"},description:{title:"Description",type:"string"},events:{title:"Events",type:"array",items:{type:"object",properties:{date:{format:"date",title:"Date",type:"string"},duration:{title:"Duration",type:"number"},time:{format:"time",title:"Time",type:"string"}}}},spaces:{title:"Spaces *",type:"string"}},required:["name","spaces"],title:"Event Chain",type:"object"}},$httpBackend.whenGET("http://www.bookingbug.com/api/v1/admin/123/event_chains/new").respond(function(){return[200,event_chain_schema,{}]}),$httpBackend.whenGET("http://www.bookingbug.com/api/v1/admin/123/event_chains/1/edit").respond(function(){return[200,event_chain_schema,{}]}),schedule1={id:1,name:"Schedule1",company_id:123,rules:{1:"0700-1500",2:"0700-1600,1800-1900","2015-02-01":"0600-1200"},_links:{self:{href:"http://www.bookingbug.com/api/v1/admin/123/schedules/1"},edit:{href:"http://www.bookingbug.com/api/v1/admin/123/schedules/edit"}}},$httpBackend.whenGET("http://www.bookingbug.com/api/v1/admin/123/schedules/1").respond(schedule1),schedules={total_entries:1,_embedded:{schedules:[schedule1]},_links:{self:{href:"http://www.bookingbug.com/api/v1/admin/123/schedules"},"new":{href:"http://www.bookingbug.com/api/v1/admin/123/schedules/new",templated:!0}}},$httpBackend.whenGET("http://www.bookingbug.com/api/v1/admin/123/schedules").respond(schedules),schedule_schema={form:[{key:"name",type:"text",feedback:!1},{key:"rules",type:"schedule",feedback:!1},{type:"submit",title:"Save"}],schema:{properties:{name:{title:"Name *",type:"string"},rules:{title:"Rules *",type:"string"}},required:["name","rules"],title:"Schema",type:"object"}},$httpBackend.whenGET("http://www.bookingbug.com/api/v1/admin/123/schedules/new").respond(function(){return[200,schedule_schema,{}]}),$httpBackend.whenGET("http://www.bookingbug.com/api/v1/admin/123/schedules/edit").respond(function(){return[200,schedule_schema,{}]})})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;window.Collection.Booking=function(superClass){function Booking(){return Booking.__super__.constructor.apply(this,arguments)}return extend(Booking,superClass),Booking.prototype.checkItem=function(item){return Booking.__super__.checkItem.apply(this,arguments)},Booking.prototype.matchesParams=function(item){return null!=this.params.start_date&&(null==this.start_date&&(this.start_date=moment(this.params.date)),this.start_date.isAfter(item.start))?!1:null!=this.params.end_date&&(null==this.end_date&&(this.end_date=moment(this.params.end_date)),this.end_date.isBefore(item.start.clone().startOf("day")))?!1:!this.params.include_cancelled&&item.is_cancelled?!1:!0},Booking}(window.Collection.Base),angular.module("BB.Services").provider("BookingCollections",function(){return{$get:function(){return new window.BaseCollections}}})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;window.Collection.Client=function(superClass){function Client(){return Client.__super__.constructor.apply(this,arguments)}return extend(Client,superClass),Client.prototype.checkItem=function(item){return Client.__super__.checkItem.apply(this,arguments)},Client}(window.Collection.Base),angular.module("BB.Services").provider("ClientCollections",function(){return{$get:function(){return new window.BaseCollections}}})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;window.Collection.Slot=function(superClass){function Slot(){return Slot.__super__.constructor.apply(this,arguments)}return extend(Slot,superClass),Slot.prototype.checkItem=function(item){return Slot.__super__.checkItem.apply(this,arguments)},Slot.prototype.matchesParams=function(item){return this.params.start_date&&(this.start_date||(this.start_date=moment(this.params.start_date)),this.start_date.isAfter(item.date))?!1:this.params.end_date&&(this.end_date||(this.end_date=moment(this.params.end_date)),this.end_date.isBefore(item.date))?!1:!0},Slot}(window.Collection.Base),angular.module("BB.Services").provider("SlotCollections",function(){return{$get:function(){return new window.BaseCollections}}})}.call(this),function(){"use strict";angular.module("BBAdmin.Controllers").controller("CalendarCtrl",function($scope,AdminBookingService,$rootScope){return $scope.eventsF=function(start,end,tz,callback){var bookings,prms;return console.log(start,end,callback),prms={company_id:21},prms.start_date=start.format("YYYY-MM-DD"),prms.end_date=end.format("YYYY-MM-DD"),bookings=AdminBookingService.query(prms),bookings.then(function(_this){return function(s){return console.log(s.items),callback(s.items),s.addCallback(function(booking){return $scope.myCalendar.fullCalendar("renderEvent",booking,!0)})}}(this))},$scope.dayClick=function(date,allDay,jsEvent,view){return $scope.$apply(function(_this){return function(){return console.log(date,allDay,jsEvent,view),$scope.alertMessage="Day Clicked "+date}}(this))},$scope.alertOnDrop=function(event,revertFunc,jsEvent,ui,view){return $scope.$apply(function(_this){return function(){return $scope.popupTimeAction({action:"move",booking:event,newdate:event.start,onCancel:revertFunc})}}(this))},$scope.alertOnResize=function(event,revertFunc,jsEvent,ui,view){return $scope.$apply(function(_this){return function(){return $scope.alertMessage="Event Resized "}}(this))},$scope.addRemoveEventSource=function(sources,source){var canAdd;return canAdd=0,angular.forEach(sources,function(_this){return function(value,key){return sources[key]===source?(sources.splice(key,1),canAdd=1):void 0}}(this)),0===canAdd?sources.push(source):void 0},$scope.addEvent=function(){var m,y;return y="",m="",$scope.events.push({title:"Open Sesame",start:new Date(y,m,28),end:new Date(y,m,29),className:["openSesame"]})},$scope.remove=function(index){return $scope.events.splice(index,1)},$scope.changeView=function(view){return $scope.myCalendar.fullCalendar("changeView",view)},$scope.eventClick=function(event,jsEvent,view){return $scope.$apply(function(_this){return function(){return $scope.selectBooking(event)}}(this))},$scope.selectTime=function(start,end,allDay){return $scope.$apply(function(_this){return function(){return $scope.popupTimeAction({start_time:moment(start),end_time:moment(end),allDay:allDay}),$scope.myCalendar.fullCalendar("unselect")}}(this))},$scope.uiConfig={calendar:{height:450,editable:!0,header:{left:"month agendaWeek agendaDay",center:"title",right:"today prev,next"},dayClick:$scope.dayClick,eventClick:$scope.eventClick,eventDrop:$scope.alertOnDrop,eventResize:$scope.alertOnResize,selectable:!0,selectHelper:!0,select:$scope.selectTime}},$scope.eventSources=[$scope.eventsF]})}.call(this),function(){angular.module("BBAdmin.Controllers").controller("CategoryList",function($scope,$location,CategoryService,$rootScope){return $rootScope.connection_started.then(function(_this){return function(){return $scope.categories=CategoryService.query($scope.bb.company),$scope.categories.then(function(items){})}}(this)),$scope.$watch("selectedCategory",function(_this){return function(newValue,oldValue){var items;return $rootScope.category=newValue,items=$(".inline_time").each(function(idx,e){return angular.element(e).scope().clear()})}}(this)),$scope.$on("Refresh_Cat",function(_this){return function(event,message){return $scope.$apply()}}(this))})}.call(this),function(){"use strict";angular.module("BBAdmin.Directives").directive("bbAdminClients",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"AdminClients",link:function(scope,element,attrs){}}}),angular.module("BBAdmin.Controllers").controller("AdminClients",function($scope,$rootScope,$q,AdminClientService,ClientDetailsService,AlertService){return $scope.clientDef=$q.defer(),$scope.clientPromise=$scope.clientDef.promise,$scope.per_page=15,$scope.total_entries=0,$scope.clients=[],$scope.getClients=function(currentPage,filterBy,filterByFields,orderBy,orderByReverse){var clientDef;return console.log(currentPage,filterBy,filterByFields,orderBy,orderByReverse),clientDef=$q.defer(),$rootScope.connection_started.then(function(){return $scope.notLoaded($scope),AdminClientService.query({company_id:$scope.bb.company_id,per_page:$scope.per_page,page:currentPage+1,filter_by:filterBy,filter_by_fields:filterByFields,order_by:orderBy,order_by_reverse:orderByReverse}).then(function(_this){return function(clients){return $scope.clients=clients.items,$scope.setLoaded($scope),$scope.setPageLoaded(),$scope.total_entries=clients.total_entries,console.log($scope.clients),clientDef.resolve(clients.items)}}(this),function(err){return clientDef.reject(err),$scope.setLoadedAndShowError($scope,err,"Sorry, something went wrong")})}),!0},$scope.edit=function(item){return console.log(item)}})}.call(this),function(){angular.module("BBAdmin.Controllers").controller("CompanyList",function($scope,$rootScope,$location){return $scope.selectedCategory=null,$rootScope.connection_started.then(function(_this){return function(){var d,date,end,results;for(date=moment(),$scope.current_date=date,$scope.companies=$scope.bb.company.companies,$scope.companies&&0!==$scope.companies.length||($scope.companies=[$scope.bb.company]),$scope.dates=[],end=moment(date).add(21,"days"),$scope.end_date=end,d=moment(date),results=[];d.isBefore(end);)$scope.dates.push(d.clone()),results.push(d.add(1,"days"));return results}}(this)),$scope.selectCompany=function(item){return window.location="/view/dashboard/pick_company/"+item.id},$scope.advance_date=function(num){var d,date,results;for(date=$scope.current_date.add(num,"days"),$scope.end_date=moment(date).add(21,"days"),$scope.current_date=moment(date),$scope.dates=[],d=date.clone(),results=[];d.isBefore($scope.end_date);)$scope.dates.push(d.clone()),results.push(d.add(1,"days"));return results},$scope.$on("Refresh_Comp",function(event,message){return $scope.$apply()})})}.call(this),function(){angular.module("BBAdmin.Controllers").controller("DashboardContainer",function($scope,$rootScope,$location,$modal){var ModalInstanceCtrl;return $scope.selectedBooking=null,$scope.poppedBooking=null,$scope.selectBooking=function(booking){return $scope.selectedBooking=booking},$scope.popupBooking=function(booking){var modalInstance;return $scope.poppedBooking=booking,modalInstance=$modal.open({templateUrl:"full_booking_details",controller:ModalInstanceCtrl,scope:$scope,backdrop:!0,resolve:{items:function(_this){return function(){return{booking:booking}}}(this)}}),modalInstance.result.then(function(_this){return function(selectedItem){return $scope.selected=selectedItem}}(this),function(_this){return function(){return console.log("Modal dismissed at: "+new Date)}}(this))},ModalInstanceCtrl=function($scope,$modalInstance,items){return angular.extend($scope,items),$scope.ok=function(){return console.log("closeing",items,items.booking&&items.booking.self?items.booking.$update():void 0),$modalInstance.close()},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}},$scope.popupTimeAction=function(prms){var modalInstance;return console.log(prms),modalInstance=$modal.open({templateUrl:$scope.partial_url+"time_popup",controller:ModalInstanceCtrl,scope:$scope,backdrop:!1,resolve:{items:function(_this){return function(){return prms}}(this)}})}})}.call(this),function(){"use strict";angular.module("BBAdmin.Controllers").controller("DashDayList",function($scope,$rootScope,$q,AdminDayService){return $scope.init=function(_this){return function(company_id){var date,dayListDef,prms,weekListDef;return $scope.inline_items="",company_id&&($scope.bb.company_id=company_id),$scope.current_date||($scope.current_date=moment().startOf("month")),date=$scope.current_date,prms={date:date.format("DD-MM-YYYY"),company_id:$scope.bb.company_id},$scope.service_id&&(prms.service_id=$scope.service_id),$scope.end_date&&(prms.edate=$scope.end_date.format("DD-MM-YYYY")),dayListDef=$q.defer(),weekListDef=$q.defer(),$scope.dayList=dayListDef.promise,$scope.weeks=weekListDef.promise,prms.url=$scope.bb.api_url,AdminDayService.query(prms).then(function(days){return $scope.sdays=days,dayListDef.resolve(),$scope.category?$scope.update_days():void 0})}}(this),$scope.format_date=function(_this){return function(fmt){return $scope.current_date.format(fmt)}}(this),$scope.selectDay=function(_this){return function(day,dayBlock,e){var elm,seldate,xelm;return 0===day.spaces?!1:(seldate=moment($scope.current_date),seldate.date(day.day),$scope.selected_date=seldate,elm=angular.element(e.toElement),elm.parent().children().removeClass("selected"),elm.addClass("selected"),xelm=$("#tl_"+$scope.bb.company_id),$scope.service_id=dayBlock.service_id,$scope.service={id:dayBlock.service_id,name:dayBlock.name},$scope.selected_day=day,0===xelm.length?$scope.inline_items="/view/dash/time_small":xelm.scope().init(day))}}(this),$scope.$watch("current_date",function(_this){return function(newValue,oldValue){return newValue&&$scope.bb.company_id?$scope.init():void 0}}(this)),$scope.update_days=function(_this){return function(){var day,i,len,ref,results;for($scope.dayList=[],$scope.service_id=null,ref=$scope.sdays,results=[],i=0,len=ref.length;len>i;i++)day=ref[i],day.category_id===$scope.category.id?($scope.dayList.push(day),results.push($scope.service_id=day.id)):results.push(void 0);return results}}(this),$rootScope.$watch("category",function(_this){return function(newValue,oldValue){return newValue&&$scope.sdays?$scope.update_days():void 0}}(this))})}.call(this),function(){angular.module("BBAdmin.Controllers").controller("EditBookingDetails",function($scope,$location,$rootScope){})}.call(this),function(){angular.module("BBAdmin.Directives").directive("bbAdminLogin",function(){return{restrict:"AE",replace:!0,scope:{onSuccess:"=",onCancel:"=",onError:"=",bb:"="},controller:"AdminLogin",template:'<div ng-include="login_template"></div>'}}),angular.module("BBAdmin.Controllers").controller("AdminLogin",function($scope,$rootScope,AdminLoginService,$q,$sessionStorage){return $scope.login={host:$sessionStorage.getItem("host"),email:null,password:null},$scope.login_template="admin_login.html",$scope.login=function(){var params;return $scope.alert="",params={email:$scope.login.email,password:$scope.login.password},AdminLoginService.login(params).then(function(user){return null==user.company_id?user.getAdministratorsPromise().then(function(administrators){return $scope.administrators=administrators,$scope.pickCompany()}):($scope.user=user,$scope.onSuccess?$scope.onSuccess():void 0)},function(err){return $scope.alert="Sorry, either your email or password was incorrect"})},$scope.pickCompany=function(){return $scope.login_template="pick_company.html"},$scope.selectedCompany=function(){var params;return $scope.alert="",params={email:$scope.email,password:$scope.password},$scope.selected_admin.$post("login",{},params).then(function(login){return $scope.selected_admin.getCompanyPromise().then(function(company){return $scope.bb.company=company,AdminLoginService.setLogin($scope.selected_admin),$scope.onSuccess(company)})})}})}.call(this),function(){angular.module("BBAdmin.Controllers").controller("SelectedBookingDetails",function($scope,$location,AdminBookingService,$rootScope){return $scope.$watch("selectedBooking",function(_this){return function(newValue,oldValue){return newValue?($scope.booking=newValue,$scope.showItemView="/view/dash/booking_details"):void 0}}(this))})}.call(this),SpaceMonitorCtrl.$inject=["$scope","$location","CompanyService"],function(){"use strict";angular.module("BBAdmin.Controllers").controller("DashTimeList",function($scope,$rootScope,$location,$q,$element,AdminTimeService){var $loaded;return $loaded=null,$scope.init=function(_this){return function(day){var elem,prms,timeListDef;return $scope.selected_day=day,elem=angular.element($element),elem.attr("id","tl_"+$scope.bb.company_id),angular.element($element).show(),prms={company_id:$scope.bb.company_id,day:day},$scope.service_id&&(prms.service_id=$scope.service_id),timeListDef=$q.defer(),$scope.slots=timeListDef.promise,prms.url=$scope.bb.api_url,$scope.aslots=AdminTimeService.query(prms),$scope.aslots.then(function(res){var i,k,len,slot,slots,x,xres;for($scope.loaded=!0,slots={},i=0,len=res.length;len>i;i++)x=res[i],slots[x.time]||(slots[x.time]=x);xres=[];for(k in slots)slot=slots[k],xres.push(slot);return timeListDef.resolve(xres)})}}(this),$scope.selected_day&&$scope.init($scope.selected_day),$scope.format_date=function(_this){
return function(fmt){return $scope.selected_date.format(fmt)}}(this),$scope.selectSlot=function(_this){return function(slot,route){return $scope.pickTime(slot.time),$scope.pickDate($scope.selected_date),$location.path(route)}}(this),$scope.highlighSlot=function(_this){return function(slot){return $scope.pickTime(slot.time),$scope.pickDate($scope.selected_date),$scope.setCheckout(!0)}}(this),$scope.clear=function(_this){return function(){return $scope.loaded=!1,$scope.slots=null,angular.element($element).hide()}}(this),$scope.popupCheckout=function(_this){return function(slot){var dHeight,dWidth,dlg,item,k,src,url,v,wHeight,wWidth;item={time:slot.time,date:$scope.selected_day.date,company_id:$scope.bb.company_id,duration:30,service_id:$scope.service_id,event_id:slot.id},url="/booking/new_checkout?";for(k in item)v=item[k],url+=k+"="+v+"&";return wWidth=$(window).width(),dWidth=.8*wWidth,wHeight=$(window).height(),dHeight=.8*wHeight,dlg=$("#dialog-modal"),src=dlg.html("<iframe frameborder=0 id='mod_dlg' onload='nowait();setTimeout(set_iframe_focus, 100);' width=100% height=99% src='"+url+"'></iframe>"),dlg.attr("title","Checkout"),dlg.dialog({my:"top",at:"top",height:dHeight,width:dWidth,modal:!0,overlay:{opacity:.1,background:"black"}})}}(this)})}.call(this),function(){angular.module("BBAdmin.Controllers").controller("TimeOptions",function($scope,$location,$rootScope,AdminResourceService,AdminPersonService){return AdminResourceService.query({company:$scope.bb.company}).then(function(resources){return $scope.resources=resources}),AdminPersonService.query({company:$scope.bb.company}).then(function(people){return $scope.people=people}),$scope.block=function(){return $scope.person&&AdminPersonService.block($scope.bb.company,$scope.person,{start_time:$scope.start_time,end_time:$scope.end_time}),$scope.ok()}})}.call(this),function(){angular.module("BBAdmin").directive("bookingTable",function(AdminCompanyService,AdminBookingService,$modal,$log,ModalForm){var controller,link;return controller=function($scope){return $scope.fields=["id","datetime"],$scope.getBookings=function(){var params;return params={company:$scope.company},AdminBookingService.query(params).then(function(bookings){return $scope.bookings=bookings})},$scope.newBooking=function(){return ModalForm["new"]({company:$scope.company,title:"New Booking",new_rel:"new_booking",post_rel:"bookings",success:function(booking){return $scope.bookings.push(booking)}})},$scope.edit=function(booking){return ModalForm.edit({model:booking,title:"Edit Booking"})}},link=function(scope,element,attrs){return scope.company?scope.getBookings():AdminCompanyService.query(attrs).then(function(company){return scope.company=company,scope.getBookings()})},{controller:controller,link:link,templateUrl:"booking_table_main.html"}})}.call(this),angular.module("BBAdmin.Directives").controller("CalController",function($scope){$scope.calendarConfig={height:450,editiable:!0,dayClick:function(){scope.$apply($scope.alertEventOnClick)}}}),function(){"use strict";angular.module("BBAdmin.Directives").directive("bbPeopleList",function($rootScope){return{restrict:"AE",replace:!0,scope:!0,controller:function($scope,$rootScope,PersonService,$q,BBModel,PersonModel){return $rootScope.connection_started.then(function(){return $scope.bb.company.getPeoplePromise().then(function(people){var i,len,person,results;for($scope.people=people,results=[],i=0,len=people.length;len>i;i++)person=people[i],results.push(person.show=!0);return results})}),$scope.show_all_people=function(){var i,len,ref,results,x;for(ref=$scope.people,results=[],i=0,len=ref.length;len>i;i++)x=ref[i],results.push(x.show=!0);return results},$scope.hide_all_people=function(){var i,len,ref,results,x;for(ref=$scope.people,results=[],i=0,len=ref.length;len>i;i++)x=ref[i],results.push(x.show=!1);return results}},link:function(scope,element,attrs){}}}),angular.module("BBAdmin.Directives").directive("bbBookingList",function(){return{restrict:"AE",replace:!0,scope:{bookings:"=",cancelled:"=",params:"="},templateUrl:function(tElm,tAttrs){return tAttrs.template},controller:function($scope,$filter){var status;return $scope.title=$scope.params.title,status=$scope.params.status,$scope.$watch(function(){return $scope.bookings},function(){var bookings,cancelled;return bookings=$scope.bookings,cancelled=$scope.cancelled,null==cancelled&&(cancelled=!1),null!=bookings&&(bookings=$filter("filter")(bookings,function(booking){var ret;return ret=booking.is_cancelled===cancelled,ret&=null!=status?booking.hasStatus(status):null==booking.multi_status||0===Object.keys(booking.multi_status).length,ret&=4===booking.status}),$scope.relevantBookings=$filter("orderBy")(bookings,"datetime")),null!=$scope.relevantBookings?$scope.relevantBookings:$scope.relevantBookings=[]})}}})}.call(this),function(){"use strict";var bbAdminFilters;bbAdminFilters=angular.module("BBAdmin.Filters",[]),bbAdminFilters.filter("rag",function(){return function(value,v1,v2){return v1>=value?"red":v2>=value?"amber":"green"}}),bbAdminFilters.filter("gar",function(){return function(value,v1,v2){return v1>=value?"green":v2>=value?"amber":"red"}}),bbAdminFilters.filter("time",function($window){return function(v){return $window.sprintf("%02d:%02d",Math.floor(v/60),v%60)}})}.call(this),function(){"use strict";var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;angular.module("BB.Models").factory("Admin.BookingModel",function($q,BBModel,BaseModel){var Admin_Booking;return Admin_Booking=function(superClass){function Admin_Booking(data){Admin_Booking.__super__.constructor.apply(this,arguments),this.datetime=moment(this.datetime),this.start=this.datetime,this.end=this.datetime.clone().add(this.duration,"minutes"),this.title=this.full_describe,this.time=60*this.start.hour()+this.start.minute(),this.allDay=!1,3===this.status?this.className="status_blocked":4===this.status&&(this.className="status_booked")}return extend(Admin_Booking,superClass),Admin_Booking.prototype.getPostData=function(){var data,q;return data={},data.date=this.start.format("YYYY-MM-DD"),data.time=60*this.start.hour()+this.start.minute(),data.duration=this.duration,data.id=this.id,data.questions=function(){var i,len,ref,results;for(ref=this.questions,results=[],i=0,len=ref.length;len>i;i++)q=ref[i],results.push(q.getPostData());return results}.call(this),data},Admin_Booking.prototype.hasStatus=function(status){return null!=this.multi_status[status]},Admin_Booking.prototype.statusTime=function(status){return this.multi_status[status]?moment(this.multi_status[status]):null},Admin_Booking.prototype.sinceStatus=function(status){var s;return s=this.statusTime(status),s?Math.floor((moment().unix()-s.unix())/60):0},Admin_Booking.prototype.sinceStart=function(options){var s,start;return start=this.datetime.unix(),Math.floor(options?options.later&&(s=this.statusTime(options.later).unix(),s>start)?(moment().unix()-s)/60:options.earlier&&(s=this.statusTime(options.earlier).unix(),start>s)?(moment().unix()-s)/60:(moment().unix()-start)/60:(moment().unix()-start)/60)},Admin_Booking.prototype.$update=function(){var data;return data=this.getPostData(),this.$put("self",{},data).then(function(_this){return function(res){return _this.constructor(res)}}(this))},Admin_Booking}(BaseModel)})}.call(this),function(){"use strict";var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;angular.module("BB.Models").factory("Admin.LoginModel",function($q,BBModel,BaseModel){var Admin_Login;return Admin_Login=function(superClass){function Admin_Login(data){Admin_Login.__super__.constructor.call(this,data)}return extend(Admin_Login,superClass),Admin_Login}(BaseModel)})}.call(this),function(){"use strict";var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;angular.module("BB.Models").factory("Admin.SlotModel",function($q,BBModel,BaseModel,TimeSlotModel){var Admin_Slot;return Admin_Slot=function(superClass){function Admin_Slot(data){Admin_Slot.__super__.constructor.call(this,data),this.title=this.full_describe,0===this.status&&(this.title="Available"),this.datetime=moment(this.datetime),this.start=this.datetime,this.end=this.datetime.clone().add(this.duration,"minutes"),this.time=60*this.start.hour()+this.start.minute(),this.allDay=!1,3===this.status?this.className="status_blocked":4===this.status?this.className="status_booked":0===this.status&&(this.className="status_available")}return extend(Admin_Slot,superClass),Admin_Slot}(TimeSlotModel)})}.call(this),function(){angular.module("BBAdmin.Services").factory("AdminBookingService",function($q,$window,halClient,BookingCollections,BBModel,UriTemplate){return{query:function(prms){var deferred,existing,href,uri,url;return prms.slot&&(prms.slot_id=prms.slot.id),prms.date&&(prms.start_date=prms.date,prms.end_date=prms.date),null==prms.per_page&&(prms.per_page=1024),null==prms.include_cancelled&&(prms.include_cancelled=!1),deferred=$q.defer(),existing=BookingCollections.find(prms),existing?deferred.resolve(existing):prms.company?prms.company.$get("bookings").then(function(collection){return collection.$get("bookings").then(function(bookings){var b,models;return models=function(){var i,len,results;for(results=[],i=0,len=bookings.length;len>i;i++)b=bookings[i],results.push(new BBModel.Admin.Booking(b));return results}(),deferred.resolve(models)},function(err){return deferred.reject(err)})},function(err){return deferred.reject(err)}):(url="",prms.url&&(url=prms.url),href=url+"/api/v1/admin/{company_id}/bookings{?slot_id,start_date,end_date,service_id,resource_id,person_id,page,per_page,include_cancelled}",uri=new UriTemplate(href).fillFromObject(prms||{}),halClient.$get(uri,{}).then(function(_this){return function(found){return found.$get("bookings").then(function(items){var i,item,len,sitems,spaces;for(sitems=[],i=0,len=items.length;len>i;i++)item=items[i],sitems.push(new BBModel.Admin.Booking(item));return spaces=new $window.Collection.Booking(found,sitems,prms),BookingCollections.add(spaces),deferred.resolve(spaces)})}}(this),function(_this){return function(err){return deferred.reject(err)}}(this))),deferred.promise},getBooking:function(prms){var deferred,href,uri;return deferred=$q.defer(),href="/api/v1/admin/{company_id}/bookings/{id}{?embed}",uri=new UriTemplate(href).fillFromObject(prms||{}),halClient.$get(uri,{no_cache:!0}).then(function(item){var booking;return booking=new BBModel.Admin.Booking(item),BookingCollections.checkItems(booking),deferred.resolve(booking)},function(_this){return function(err){return deferred.reject(err)}}(this)),deferred.promise},cancelBooking:function(prms,booking){var deferred,href,notify,uri;return deferred=$q.defer(),href="/api/v1/admin/{company_id}/bookings/{id}?notify={notify}",null==prms.id&&(prms.id=booking.id),notify=prms.notify,null==notify&&(notify=!0),uri=new UriTemplate(href).fillFromObject(prms||{}),halClient.$del(uri,{notify:notify}).then(function(item){return booking=new BBModel.Admin.Booking(item),BookingCollections.checkItems(booking),deferred.resolve(booking)},function(_this){return function(err){return deferred.reject(err)}}(this)),deferred.promise},updateBooking:function(prms,booking){var deferred,href,uri;return deferred=$q.defer(),href="/api/v1/admin/{company_id}/bookings/{id}",null==prms.id&&(prms.id=booking.id),uri=new UriTemplate(href).fillFromObject(prms||{}),halClient.$put(uri,{},prms).then(function(item){return booking=new BBModel.Admin.Booking(item),BookingCollections.checkItems(booking),deferred.resolve(booking)},function(_this){return function(err){return deferred.reject(err)}}(this)),deferred.promise},blockTimeForPerson:function(prms,person){var deferred,href,uri;return deferred=$q.defer(),href="/api/v1/admin/{company_id}/people/{person_id}/block",null==prms.person_id&&(prms.person_id=person.id),prms.booking=!0,uri=new UriTemplate(href).fillFromObject(prms||{}),halClient.$put(uri,{},prms).then(function(item){var booking;return booking=new BBModel.Admin.Booking(item),BookingCollections.checkItems(booking),deferred.resolve(booking)},function(_this){return function(err){return deferred.reject(err)}}(this)),deferred.promise},addStatusToBooking:function(prms,booking,status){var deferred,href,uri;return deferred=$q.defer(),href="/api/v1/admin/{company_id}/bookings/{booking_id}/multi_status",null==prms.booking_id&&(prms.booking_id=booking.id),uri=new UriTemplate(href).fillFromObject(prms||{}),halClient.$put(uri,{},{status:status}).then(function(item){return booking=new BBModel.Admin.Booking(item),BookingCollections.checkItems(booking),deferred.resolve(booking)},function(_this){return function(err){return deferred.reject(err)}}(this)),deferred.promise},addPrivateNoteToBooking:function(prms,booking,note){var deferred,href,noteParam,uri;return deferred=$q.defer(),href="/api/v1/admin/{company_id}/bookings/{booking_id}/private_notes",null==prms.booking_id&&(prms.booking_id=booking.id),null!=note.note&&(noteParam=note.note),null==noteParam&&(noteParam=note),uri=new UriTemplate(href).fillFromObject(prms||{}),halClient.$put(uri,{},{note:noteParam}).then(function(item){return booking=new BBModel.Admin.Booking(item),BookingCollections.checkItems(booking),deferred.resolve(booking)},function(_this){return function(err){return deferred.reject(err)}}(this)),deferred.promise},updatePrivateNoteForBooking:function(prms,booking,note){var deferred,href,uri;return deferred=$q.defer(),href="/api/v1/admin/{company_id}/bookings/{booking_id}/private_notes/{id}",null==prms.booking_id&&(prms.booking_id=booking.id),null==prms.id&&(prms.id=note.id),uri=new UriTemplate(href).fillFromObject(prms||{}),halClient.$put(uri,{},{note:note.note}).then(function(item){return booking=new BBModel.Admin.Booking(item),BookingCollections.checkItems(booking),deferred.resolve(booking)},function(_this){return function(err){return deferred.reject(err)}}(this)),deferred.promise},deletePrivateNoteFromBooking:function(prms,booking,note){var deferred,href,uri;return deferred=$q.defer(),href="/api/v1/admin/{company_id}/bookings/{booking_id}/private_notes/{id}",null==prms.booking_id&&(prms.booking_id=booking.id),null==prms.id&&(prms.id=note.id),uri=new UriTemplate(href).fillFromObject(prms||{}),halClient.$del(uri,{}).then(function(item){return booking=new BBModel.Admin.Booking(item),BookingCollections.checkItems(booking),deferred.resolve(booking)},function(_this){return function(err){return deferred.reject(err)}}(this)),deferred.promise}}})}.call(this),function(){angular.module("BBAdmin.Services").factory("AdminClientService",function($q,$window,$rootScope,halClient,ClientCollections,BBModel,UriTemplate){return{query:function(prms){var deferred,href,uri,url;return prms.company&&(prms.company_id=prms.company.id),url="",$rootScope.bb.api_url&&(url=$rootScope.bb.api_url),href=url+"/api/v1/admin/{company_id}/client{/id}{?page,per_page,filter_by,filter_by_fields,order_by,order_by_reverse}",uri=new UriTemplate(href).fillFromObject(prms||{}),deferred=$q.defer(),halClient.$get(uri,{}).then(function(_this){return function(resource){var client;return resource.$has("clients")?resource.$get("clients").then(function(items){var clients,i,j,len,people;for(people=[],j=0,len=items.length;len>j;j++)i=items[j],people.push(new BBModel.Client(i));return clients=new $window.Collection.Client(resource,people,prms),clients.total_entries=resource.total_entries,ClientCollections.add(clients),deferred.resolve(clients)}):(client=new BBModel.Client(resource),deferred.resolve(client))}}(this),function(_this){return function(err){return deferred.reject(err)}}(this)),deferred.promise},update:function(client){var deferred;return deferred=$q.defer(),client.$put("self",{},client).then(function(_this){return function(res){return deferred.resolve(new BBModel.Client(res))}}(this),function(_this){return function(err){return deferred.reject(err)}}(this)),deferred.promise}}})}.call(this),function(){angular.module("BBAdmin.Services").factory("AdminCompanyService",function($q,BBModel,AdminLoginService,$rootScope,$sessionStorage){return{query:function(params){var base,base1,defer;return defer=$q.defer(),$rootScope.bb||($rootScope.bb={}),$rootScope.bb.api_url=$sessionStorage.getItem("host"),(base=$rootScope.bb).api_url||(base.api_url=params.apiUrl),(base1=$rootScope.bb).api_url||(base1.api_url="http://www.bookingbug.com"),AdminLoginService.checkLogin(params).then(function(){var login_form,options;return $rootScope.user&&$rootScope.user.company_id?($rootScope.bb||($rootScope.bb={}),$rootScope.bb.company_id=$rootScope.user.company_id,$rootScope.user.$get("company").then(function(company){return defer.resolve(company)},function(err){return defer.reject(err)})):(login_form={email:params.adminEmail,password:params.adminPassword},options={company_id:params.companyId},AdminLoginService.login(login_form,options).then(function(user){return user.$get("company").then(function(company){return defer.resolve(company)},function(err){return defer.reject(err)})},function(err){return defer.reject(err)}))}),defer.promise}}})}.call(this),function(){angular.module("BBAdmin.Services").factory("AdminDayService",function($q,$window,halClient,BBModel,UriTemplate){return{query:function(prms){var deferred,href,uri,url;return url="",prms.url&&(url=prms.url),href=url+"/api/v1/{company_id}/day_data{?month,week,date,edate,event_id,service_id}",uri=new UriTemplate(href).fillFromObject(prms||{}),deferred=$q.defer(),halClient.$get(uri,{}).then(function(_this){return function(found){var item,j,len,mdays,ref;if(found.items){for(mdays=[],ref=found.items,j=0,len=ref.length;len>j;j++)item=ref[j],halClient.$get(item.uri).then(function(data){var days,dcol,i,k,len1,ref1;for(days=[],ref1=data.days,k=0,len1=ref1.length;len1>k;k++)i=ref1[k],i.type===prms.item&&days.push(new BBModel.Day(i));return dcol=new $window.Collection.Day(data,days,{}),mdays.push(dcol)});return deferred.resolve(mdays)}}}(this),function(_this){return function(err){return deferred.reject(err)}}(this)),deferred.promise}}})}.call(this),function(){angular.module("BBAdmin.Services").factory("AdminLoginService",function($q,halClient,$rootScope,BBModel,$sessionStorage,$cookies,UriTemplate){return{login:function(form,options){var deferred,url;return deferred=$q.defer(),url=$rootScope.bb.api_url+"/api/v1/login/admin",null!=options&&null!=options.company_id&&(url=url+"/"+options.company_id),halClient.$post(url,options,form).then(function(_this){return function(login){var login_model;return login.$has("administrator")?login.$get("administrator").then(function(user){return user=_this.setLogin(user),deferred.resolve(user)}):login.$has("administrators")?(login_model=new BBModel.Admin.Login(login),deferred.resolve(login_model)):deferred.reject("No admin account for login")}}(this),function(_this){return function(err){var login,login_model;return 400===err.status?(login=halClient.$parse(err.data),login.$has("administrators")?(login_model=new BBModel.Admin.Login(login),deferred.resolve(login_model)):deferred.reject(err)):deferred.reject(err)}}(this)),deferred.promise},ssoLogin:function(options,data){var deferred,url;return deferred=$q.defer(),url=$rootScope.bb.api_url+"/api/v1/login/sso/"+options.company_id,halClient.$post(url,{},data).then(function(_this){return function(login){var params;return params={auth_token:login.auth_token},login.$get("user").then(function(user){return user=_this.setLogin(user),deferred.resolve(user)})}}(this),function(_this){return function(err){return deferred.reject(err)}}(this)),deferred.promise},isLoggedIn:function(){return this.checkLogin().then(function(){return $rootScope.user?!0:!1})},setLogin:function(user){var auth_token;return auth_token=user.getOption("auth_token"),user=new BBModel.Admin.User(user),$sessionStorage.setItem("user",user.$toStore()),$sessionStorage.setItem("auth_token",auth_token),$rootScope.user=user,user},user:function(){return this.checkLogin().then(function(){return $rootScope.user})},checkLogin:function(params){var auth_token,defer,href,options,url,user;return null==params&&(params={}),defer=$q.defer(),$rootScope.user&&defer.resolve(),user=$sessionStorage.getItem("user"),user?($rootScope.user=halClient.createResource(user),defer.resolve()):(auth_token=$cookies["Auth-Token"],auth_token?(url=$rootScope.bb.api_url?$rootScope.bb.api_url+"/api/v1/login{?id,role}":"/api/v1/login{?id,role}",params.id=params.companyId||params.company_id,params.role="admin",href=new UriTemplate(url).fillFromObject(params||{}),options={auth_token:auth_token},halClient.$get(href,options).then(function(_this){return function(login){return login.$has("administrator")?login.$get("administrator").then(function(user){return $rootScope.user=new BBModel.Admin.User(user),defer.resolve()}):defer.resolve()}}(this),function(){return defer.resolve()})):defer.resolve()),defer.promise},logout:function(){return $rootScope.user=null,$sessionStorage.removeItem("user"),$sessionStorage.removeItem("auth_token"),$cookies["Auth-Token"]=null},getLogin:function(options){var defer,url;return defer=$q.defer(),url=$rootScope.bb.api_url+"/api/v1/login/admin/"+options.company_id,halClient.$get(url,options).then(function(_this){return function(login){return login.$has("administrator")?login.$get("administrator").then(function(user){return user=_this.setLogin(user),defer.resolve(user)},function(err){return defer.reject(err)}):defer.reject()}}(this),function(err){return defer.reject(err)}),defer.promise}}})}.call(this),function(){angular.module("BBAdmin.Services").factory("AdminPurchaseService",function($q,halClient,BBModel){return{query:function(params){var defer,uri;return defer=$q.defer(),uri=params.url_root+"/api/v1/admin/purchases/"+params.purchase_id,halClient.$get(uri,params).then(function(purchase){return purchase=new BBModel.Purchase.Total(purchase),defer.resolve(purchase)},function(err){return defer.reject(err)}),defer.promise},markAsPaid:function(params){var company_id,defer,uri;return defer=$q.defer(),params.purchase&&params.url_root?(params.company&&(company_id=params.company.id),uri=params.url_root+("/api/v1/admin/"+company_id+"/purchases/"+params.purchase.id+"/pay"),halClient.$put(uri,params).then(function(purchase){return purchase=new BBModel.Purchase.Total(purchase),defer.resolve(purchase)},function(err){return defer.reject(err)}),defer.promise):(defer.reject("invalid request"),defer.promise)}}})}.call(this),function(){angular.module("BBAdmin.Services").factory("AdminSlotService",function($q,$window,halClient,SlotCollections,BBModel,UriTemplate){return{query:function(prms){var deferred,existing,href,uri,url;return deferred=$q.defer(),existing=SlotCollections.find(prms),existing?deferred.resolve(existing):prms.user?prms.user.$get("company").then(function(company){return company.$get("slots",prms).then(function(slots_collection){return slots_collection.$get("slots").then(function(slots){var s,slot_models;return slot_models=function(){var i,len,results;for(results=[],i=0,len=slots.length;len>i;i++)s=slots[i],results.push(new BBModel.Admin.Slot(s));return results}(),deferred.resolve(slot_models)},function(err){return deferred.reject(err)})})}):(url="",prms.url&&(url=prms.url),href=url+"/api/v1/admin/{company_id}/slots{?start_date,end_date,date,service_id,resource_id,person_id,page,per_page}",uri=new UriTemplate(href).fillFromObject(prms||{}),halClient.$get(uri,{}).then(function(_this){return function(found){return found.$get("slots").then(function(items){var i,item,len,sitems,slots;for(sitems=[],i=0,len=items.length;len>i;i++)item=items[i],sitems.push(new BBModel.Admin.Slot(item));return slots=new $window.Collection.Slot(found,sitems,prms),SlotCollections.add(slots),deferred.resolve(slots)})}}(this),function(_this){return function(err){return deferred.reject(err)}}(this))),deferred.promise},create:function(prms,data){var deferred,href,uri,url;return url="",prms.url&&(url=prms.url),href=url+"/api/v1/admin/{company_id}/slots",uri=new UriTemplate(href).fillFromObject(prms||{}),deferred=$q.defer(),halClient.$post(uri,{},data).then(function(_this){return function(slot){return slot=new BBModel.Admin.Slot(slot),SlotCollections.checkItems(slot),deferred.resolve(slot)}}(this),function(_this){return function(err){return deferred.reject(err)}}(this)),deferred.promise},"delete":function(item){var deferred;return deferred=$q.defer(),item.$del("self").then(function(_this){return function(slot){return slot=new BBModel.Admin.Slot(slot),SlotCollections.deleteItems(slot),deferred.resolve(slot)}}(this),function(_this){return function(err){return deferred.reject(err)}}(this)),deferred.promise},update:function(item,data){var deferred;return deferred=$q.defer(),item.$put("self",{},data).then(function(_this){return function(slot){return slot=new BBModel.Admin.Slot(slot),SlotCollections.checkItems(slot),deferred.resolve(slot)}}(this),function(_this){return function(err){return deferred.reject(err)}}(this)),deferred.promise}}})}.call(this),function(){angular.module("BBAdmin.Services").factory("AdminTimeService",function($q,$window,halClient,BBModel,UriTemplate){return{query:function(prms){var deferred,href,uri,url;return prms.day&&(prms.date=prms.day.date),!prms.edate&&prms.date&&(prms.edate=prms.date),url="",prms.url&&(url=prms.url),href=url+"/api/v1/{company_id}/time_data{?date,event_id,service_id,person_id}",uri=new UriTemplate(href).fillFromObject(prms||{}),deferred=$q.defer(),halClient.$get(uri,{no_cache:!1}).then(function(_this){return function(found){return found.$get("events").then(function(events){var event,eventItem,eventItems,i,j,len,len1,ref,time,ts;for(eventItems=[],i=0,len=events.length;len>i;i++){for(eventItem=events[i],event={},event.times=[],event.event_id=eventItem.event_id,event.person_id=found.person_id,ref=eventItem.times,j=0,len1=ref.length;len1>j;j++)time=ref[j],ts=new BBModel.TimeSlot(time),event.times.push(ts);eventItems.push(event)}return deferred.resolve(eventItems)})}}(this),function(_this){return function(err){return deferred.reject(err)}}(this)),deferred.promise}}})}.call(this);