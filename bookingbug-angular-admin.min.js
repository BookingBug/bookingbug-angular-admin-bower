"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}angular.module("BBAdmin",["BB","BBAdmin.Services","BBAdmin.Filters","BBAdmin.Directives","BBAdmin.Controllers","BBAdmin.Models","BBAdmin.Directives","trNgGrid"]),angular.module("BBAdmin.Directives",[]),angular.module("BBAdmin.Filters",[]),angular.module("BBAdmin.Models",[]),angular.module("BBAdmin.Services",["ngResource","ngSanitize"]),angular.module("BBAdmin.Controllers",["ngSanitize"]),angular.module("BBAdmin").config(function($logProvider){"ngInject";$logProvider.debugEnabled(!0)}),angular.module("BB").config(function(FormTransformProvider){"ngInject";FormTransformProvider.setTransform("edit","Admin_Booking",function(form,schema,model){var disable_list=void 0;return disable_list=model&&3===model.status?["service","person_id","resource_id"]:["datetime","service","person_id","resource_id"],form[0].tabs?_.each(form[0].tabs[0].items,function(item){if(_.indexOf(disable_list,item.key)>-1)return item.readonly=!0}):_.each(form,function(item){if(_.indexOf(disable_list,item.key)>-1)return item.readonly=!0}),form})}),angular.module("BBAdmin.Services").run(function($q,$injector,BBModel){"ngInject";var models=["Booking","Slot","User","Administrator","Schedule","Address","Resource","Person","Service","Login","EventChain","EventGroup","Event","Clinic","Company","Client"],afuncs={},_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=Array.from(models)[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var model=_step.value;afuncs[model]=$injector.get("Admin"+model+"Model")}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}BBModel.Admin=afuncs}),window.Collection.Booking=function(_window$Collection$Ba){function Booking(){return _classCallCheck(this,Booking),_possibleConstructorReturn(this,_window$Collection$Ba.apply(this,arguments))}return _inherits(Booking,_window$Collection$Ba),Booking.prototype.checkItem=function(item){var _window$Collection$Ba2;return(_window$Collection$Ba2=_window$Collection$Ba.prototype.checkItem).call.apply(_window$Collection$Ba2,[this].concat(Array.prototype.slice.call(arguments)))},Booking.prototype.matchesParams=function(item){return(null==this.params.start_date||!item.start||(null==this.start_date&&(this.start_date=moment(this.params.start_date)),!this.start_date.isAfter(item.start)))&&((null==this.params.end_date||!item.start||(null==this.end_date&&(this.end_date=moment(this.params.end_date)),!this.end_date.isBefore(item.start.clone().startOf("day"))))&&!(!this.params.include_cancelled&&item.is_cancelled))},Booking}(window.Collection.Base),angular.module("BB.Services").provider("BookingCollections",function(){return{$get:function(){return new window.BaseCollections}}}),window.Collection.Client=function(_window$Collection$Ba){function Client(){return _classCallCheck(this,Client),_possibleConstructorReturn(this,_window$Collection$Ba.apply(this,arguments))}return _inherits(Client,_window$Collection$Ba),Client.prototype.checkItem=function(item){var _window$Collection$Ba2;return(_window$Collection$Ba2=_window$Collection$Ba.prototype.checkItem).call.apply(_window$Collection$Ba2,[this].concat(Array.prototype.slice.call(arguments)))},Client}(window.Collection.Base),angular.module("BB.Services").provider("ClientCollections",function(){return{$get:function(){return new window.BaseCollections}}}),window.Collection.Slot=function(_window$Collection$Ba){function Slot(){return _classCallCheck(this,Slot),_possibleConstructorReturn(this,_window$Collection$Ba.apply(this,arguments))}return _inherits(Slot,_window$Collection$Ba),Slot.prototype.checkItem=function(item){var _window$Collection$Ba2;return(_window$Collection$Ba2=_window$Collection$Ba.prototype.checkItem).call.apply(_window$Collection$Ba2,[this].concat(Array.prototype.slice.call(arguments)))},Slot.prototype.matchesParams=function(item){return(!this.params.start_date||(this.start_date||(this.start_date=moment(this.params.start_date)),!this.start_date.isAfter(item.date)))&&(!this.params.end_date||(this.end_date||(this.end_date=moment(this.params.end_date)),!this.end_date.isBefore(item.date)))},Slot}(window.Collection.Base),angular.module("BB.Services").provider("SlotCollections",function(){return{$get:function(){return new window.BaseCollections}}}),angular.module("BBAdmin.Controllers").controller("CalendarCtrl",function($scope,BBModel,$rootScope){return $scope.eventsF=function(start,end,tz,callback){var prms={company_id:21};return prms.start_date=start.format("YYYY-MM-DD"),prms.end_date=end.format("YYYY-MM-DD"),BBModel.Admin.Booking.$query(prms).then(function(s){return callback(s.items),s.addCallback(function(booking){return $scope.myCalendar.fullCalendar("renderEvent",booking,!0)})})},$scope.dayClick=function(date,allDay,jsEvent,view){return $scope.$apply(function(){return $scope.alertMessage="Day Clicked "+date})},$scope.alertOnDrop=function(event,revertFunc,jsEvent,ui,view){return $scope.$apply(function(){return $scope.popupTimeAction({action:"move",booking:event,newdate:event.start,onCancel:revertFunc})})},$scope.alertOnResize=function(event,revertFunc,jsEvent,ui,view){return $scope.$apply(function(){return $scope.alertMessage="Event Resized "})},$scope.addRemoveEventSource=function(sources,source){var canAdd=0;if(angular.forEach(sources,function(value,key){if(sources[key]===source)return sources.splice(key,1),canAdd=1}),0===canAdd)return sources.push(source)},$scope.addEvent=function(){return $scope.events.push({title:"Open Sesame",start:new Date("","",28),end:new Date("","",29),className:["openSesame"]})},$scope.remove=function(index){return $scope.events.splice(index,1)},$scope.changeView=function(view){return $scope.myCalendar.fullCalendar("changeView",view)},$scope.eventClick=function(event,jsEvent,view){return $scope.$apply(function(){return $scope.selectBooking(event)})},$scope.selectTime=function(start,end,allDay){return $scope.$apply(function(){return $scope.popupTimeAction({start_time:moment(start),end_time:moment(end),allDay:allDay}),$scope.myCalendar.fullCalendar("unselect")})},$scope.uiConfig={calendar:{height:450,editable:!0,header:{left:"month agendaWeek agendaDay",center:"title",right:"today prev,next"},dayClick:$scope.dayClick,eventClick:$scope.eventClick,eventDrop:$scope.alertOnDrop,eventResize:$scope.alertOnResize,selectable:!0,selectHelper:!0,select:$scope.selectTime}},$scope.eventSources=[$scope.eventsF]}),angular.module("BBAdmin.Controllers").controller("CategoryList",function($scope,$location,$rootScope,BBModel){return $rootScope.connection_started.then(function(){return $scope.categories=BBModel.Category.$query($scope.bb.company),$scope.categories.then(function(items){})}),$scope.$watch("selectedCategory",function(newValue,oldValue){return $rootScope.category=newValue,$(".inline_time").each(function(idx,e){return angular.element(e).scope().clear()})}),$scope.$on("Refresh_Cat",function(event,message){return $scope.$apply()})}),angular.module("BBAdmin.Directives").directive("bbAdminClients",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"AdminClients",link:function(scope,element,attrs){}}}),angular.module("BBAdmin.Controllers").controller("AdminClients",function($scope,$rootScope,$q,$log,AlertService,LoadingService,BBModel){$scope.clientDef=$q.defer(),$scope.clientPromise=$scope.clientDef.promise,$scope.per_page=15,$scope.total_entries=0,$scope.clients=[];var loader=LoadingService.$loader($scope);return $scope.getClients=function(currentPage,filterBy,filterByFields,orderBy,orderByReverse){var clientDef=$q.defer();return $rootScope.connection_started.then(function(){loader.notLoaded();var params={company:$scope.bb.company,per_page:$scope.per_page,page:currentPage+1,filter_by:filterBy,filter_by_fields:filterByFields,order_by:orderBy,order_by_reverse:orderByReverse};return BBModel.Admin.Client.$query(params).then(function(clients){return $scope.clients=clients.items,loader.setLoaded(),$scope.setPageLoaded(),$scope.total_entries=clients.total_entries,clientDef.resolve(clients.items)},function(err){return clientDef.reject(err),loader.setLoadedAndShowError(err,"Sorry, something went wrong")})}),!0},$scope.edit=function(item){return $log.info("not implemented")}}),angular.module("BBAdmin.Controllers").controller("CompanyList",function($scope,$rootScope,$location){var d=void 0,date=void 0,result=void 0;return $scope.selectedCategory=null,$rootScope.connection_started.then(function(){date=moment(),$scope.current_date=date,$scope.companies=$scope.bb.company.companies,$scope.companies&&0!==$scope.companies.length||($scope.companies=[$scope.bb.company]),$scope.dates=[];var end=moment(date).add(21,"days");return $scope.end_date=end,d=moment(date),function(){for(result=[];d.isBefore(end);)$scope.dates.push(d.clone()),result.push(d.add(1,"days"));return result}()}),$scope.selectCompany=function(item){return $location="/view/dashboard/pick_company/"+item.id},$scope.advance_date=function(num){return date=$scope.current_date.add(num,"days"),$scope.end_date=moment(date).add(21,"days"),$scope.current_date=moment(date),$scope.dates=[],d=date.clone(),function(){for(result=[];d.isBefore($scope.end_date);)$scope.dates.push(d.clone()),result.push(d.add(1,"days"));return result}()},$scope.$on("Refresh_Comp",function(event,message){return $scope.$apply()})}),angular.module("BBAdmin.Controllers").controller("DashboardContainer",function($scope,$rootScope,$location,$uibModal,$document){$scope.selectedBooking=null,$scope.poppedBooking=null,$scope.selectBooking=function(booking){return $scope.selectedBooking=booking},$scope.popupBooking=function(booking){return $scope.poppedBooking=booking,$uibModal.open({templateUrl:"full_booking_details",controller:ModalInstanceCtrl,scope:$scope,backdrop:!0,resolve:{items:function(){return{booking:booking}}}}).result.then(function(selectedItem){return $scope.selected=selectedItem},function(){return console.log("Modal dismissed at: "+new Date)})};var ModalInstanceCtrl=function($scope,$uibModalInstance,items){return angular.extend($scope,items),$scope.ok=function(){return items.booking&&items.booking.self&&items.booking.$update(),$uibModalInstance.close()},$scope.cancel=function(){return $uibModalInstance.dismiss("cancel")}};return $scope.popupTimeAction=function(prms){return $uibModal.open({templateUrl:$scope.partial_url+"time_popup",controller:ModalInstanceCtrl,scope:$scope,backdrop:!1,resolve:{items:function(){return prms}}})}}),angular.module("BBAdmin.Controllers").controller("DashDayList",function($scope,$rootScope,$q,BBModel){var date=void 0;return $scope.init=function(company_id){$scope.inline_items="",company_id&&($scope.bb.company_id=company_id),$scope.current_date||($scope.current_date=moment().startOf("month")),date=$scope.current_date;var prms={date:date.format("DD-MM-YYYY"),company_id:$scope.bb.company_id};$scope.service_id&&(prms.service_id=$scope.service_id),$scope.end_date&&(prms.edate=$scope.end_date.format("DD-MM-YYYY"));var dayListDef=$q.defer(),weekListDef=$q.defer();return $scope.dayList=dayListDef.promise,$scope.weeks=weekListDef.promise,prms.url=$scope.bb.api_url,BBModel.Admin.Day.$query(prms).then(function(days){if($scope.sdays=days,dayListDef.resolve(),$scope.category)return $scope.update_days()})},$scope.format_date=function(fmt){return $scope.current_date.format(fmt)},$scope.selectDay=function(day,dayBlock,e){if(0===day.spaces)return!1;var seldate=moment($scope.current_date);seldate.date(day.day),$scope.selected_date=seldate;var elm=angular.element(e.toElement);elm.parent().children().removeClass("selected"),elm.addClass("selected");var xelm=$("#tl_"+$scope.bb.company_id);return $scope.service_id=dayBlock.service_id,$scope.service={id:dayBlock.service_id,name:dayBlock.name},$scope.selected_day=day,0===xelm.length?$scope.inline_items="/view/dash/time_small":xelm.scope().init(day)},$scope.$watch("current_date",function(newValue,oldValue){if(newValue&&$scope.bb.company_id)return $scope.init()}),$scope.update_days=function(){return $scope.dayList=[],$scope.service_id=null,function(){var result=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=Array.from($scope.sdays)[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var day=_step.value,item=void 0;day.category_id===$scope.category.id&&($scope.dayList.push(day),item=$scope.service_id=day.id),result.push(item)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return result}()},$rootScope.$watch("category",function(newValue,oldValue){if(newValue&&$scope.sdays)return $scope.update_days()})}),angular.module("BBAdmin.Controllers").controller("EditBookingDetails",function($scope,$location,$rootScope){}),angular.module("BBAdmin.Directives").directive("bbAdminLogin",function(){return{restrict:"AE",replace:!0,scope:{onSuccess:"=",onCancel:"=",onError:"=",bb:"="},controller:"AdminLogin",template:'<div ng-include="login_template"></div>'}}),angular.module("BBAdmin.Controllers").controller("AdminLogin",function($scope,$rootScope,$q,$sessionStorage,BBModel){return $scope.login_data={host:$sessionStorage.getItem("host"),email:null,password:null,selected_admin:null},$scope.login_template="login/admin_login.html",$scope.login=function(){$scope.alert="";var params={email:$scope.login_data.email,password:$scope.login_data.password};return BBModel.Admin.Login.$login(params).then(function(user){return null==user.company_id?user.$getAdministrators().then(function(administrators){return $scope.administrators=administrators,$scope.pickCompany()}):($scope.user=user,$scope.onSuccess?$scope.onSuccess():void 0)},function(err){return $scope.alert="Sorry, either your email or password was incorrect"})},$scope.pickCompany=function(){return $scope.login_template="login/admin_pick_company.html"},$scope.selectedCompany=function(){$scope.alert="";var params={email:$scope.login_data.email,password:$scope.login_data.password};return $scope.login_data.selected_admin.$post("login",{},params).then(function(login){return $scope.login_data.selected_admin.$getCompany().then(function(company){return $scope.bb.company=company,BBModel.Admin.Login.$setLogin($scope.login_data.selected_admin),$scope.onSuccess(company)})})}}),angular.module("BBAdmin.Controllers").controller("SelectedBookingDetails",function($scope,$location,$rootScope,BBModel){return $scope.$watch("selectedBooking",function(newValue,oldValue){if(newValue)return $scope.booking=newValue,$scope.showItemView="/view/dash/booking_details"})}),angular.module("BBAdmin.Controllers").controller("DashTimeList",function($scope,$rootScope,$location,$q,$element,AdminTimeService){var k=void 0,slots=void 0;return $scope.init=function(day){$scope.selected_day=day,angular.element($element).attr("id","tl_"+$scope.bb.company_id),angular.element($element).show();var prms={company_id:$scope.bb.company_id,day:day};$scope.service_id&&(prms.service_id=$scope.service_id);var timeListDef=$q.defer();return $scope.slots=timeListDef.promise,prms.url=$scope.bb.api_url,$scope.aslots=AdminTimeService.query(prms),$scope.aslots.then(function(res){$scope.loaded=!0,slots={};var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=Array.from(res)[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var x=_step.value;slots[x.time]||(slots[x.time]=x)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}var xres=[];for(k in slots){var slot=slots[k];xres.push(slot)}return timeListDef.resolve(xres)})},$scope.selected_day&&$scope.init($scope.selected_day),$scope.format_date=function(fmt){return $scope.selected_date.format(fmt)},$scope.selectSlot=function(slot,route){return $scope.pickTime(slot.time),$scope.pickDate($scope.selected_date),$location.path(route)},$scope.highlighSlot=function(slot){return $scope.pickTime(slot.time),$scope.pickDate($scope.selected_date),$scope.setCheckout(!0)},$scope.clear=function(){return $scope.loaded=!1,$scope.slots=null,angular.element($element).hide()},$scope.popupCheckout=function(slot){var item={time:slot.time,date:$scope.selected_day.date,company_id:$scope.bb.company_id,duration:30,service_id:$scope.service_id,event_id:slot.id},url="/booking/new_checkout?";for(k in item){url+=k+"="+item[k]+"&"}var wWidth=$(window).width(),dWidth=.8*wWidth,wHeight=$(window).height(),dHeight=.8*wHeight,dlg=$("#dialog-modal");return dlg.html("<iframe frameborder=0 id='mod_dlg' onload='nowait();setTimeout(set_iframe_focus, 100);' width=100% height=99% src='"+url+"'></iframe>"),dlg.attr("title","Checkout"),dlg.dialog({my:"top",at:"top",height:dHeight,width:dWidth,modal:!0,overlay:{opacity:.1,background:"black"}})}}),angular.module("BBAdmin.Controllers").controller("TimeOptions",function($scope,$location,$rootScope,BBModel){return BBModel.Admin.Resource.$query({company:$scope.bb.company}).then(function(resources){return $scope.resources=resources}),BBModel.Admin.Person.$query({company:$scope.bb.company}).then(function(people){return $scope.people=people}),$scope.block=function(){if($scope.person){var params={start_time:$scope.start_time,end_time:$scope.end_time};BBModel.Admin.Person.$block($scope.bb.company,$scope.person,params)}return $scope.ok()}}),angular.module("BBAdmin.Directives").directive("adminLogin",function($uibModal,$log,$rootScope,$q,$document,BBModel){var loginAdminController=function($scope,$uibModalInstance,company_id){return $scope.title="Login",$scope.schema={type:"object",properties:{email:{type:"string",title:"Email"},password:{type:"string",title:"Password"}}},$scope.form=[{key:"email",type:"email",feedback:!1,autofocus:!0},{key:"password",type:"password",feedback:!1}],$scope.login_form={},$scope.submit=function(form){var options={company_id:company_id};return BBModel.Admin.Login.$login(form,options).then(function(admin){return admin.email=form.email,admin.password=form.password,$uibModalInstance.close(admin)},function(err){return $uibModalInstance.dismiss(err)})},$scope.cancel=function(){return $uibModalInstance.dismiss("cancel")}},pickCompanyController=function($scope,$uibModalInstance,companies){var c=void 0;return $scope.title="Pick Company",$scope.schema={type:"object",properties:{company_id:{type:"integer",title:"Company"}}},$scope.schema.properties.company_id.enum=function(){var result=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=Array.from(companies)[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0)c=_step.value,result.push(c.id)}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return result}(),$scope.form=[{key:"company_id",type:"select",titleMap:function(){var result1=[],_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=Array.from(companies)[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0)c=_step2.value,result1.push({value:c.id,name:c.name})}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}return result1}(),autofocus:!0}],$scope.pick_company_form={},$scope.submit=function(form){return $uibModalInstance.close(form.company_id)},$scope.cancel=function(){return $uibModalInstance.dismiss("cancel")}};return{link:function(scope,element,attrs){$rootScope.bb||($rootScope.bb={}),$rootScope.bb.api_url||($rootScope.bb.api_url=scope.apiUrl),$rootScope.bb.api_url||($rootScope.bb.api_url="http://www.bookingbug.com");var loginModal=function loginModal(){return $uibModal.open({templateUrl:"login_modal_form.html",controller:loginAdminController,resolve:{company_id:function(){return scope.companyId}}}).result.then(function(result){return scope.adminEmail=result.email,scope.adminPassword=result.password,result.$has("admins")?result.$get("admins").then(function(admins){return scope.admins=admins,$q.all(Array.from(admins).map(function(m){return m.$get("company")})).then(function(companies){return pickCompanyModal(companies)})}):scope.admin=result},function(){return loginModal()})},pickCompanyModal=function pickCompanyModal(_companies){return $uibModal.open({templateUrl:"pick_company_modal_form.html",controller:pickCompanyController,resolve:{companies:function(){return _companies}}}).result.then(function(company_id){return scope.companyId=company_id,tryLogin()},function(){return pickCompanyModal()})},tryLogin=function(){var login_form={email:scope.adminEmail,password:scope.adminPassword},options={company_id:scope.companyId};return BBModel.Admin.Login.$login(login_form,options).then(function(result){return result.$has("admins")?result.$get("admins").then(function(admins){return scope.admins=admins,$q.all(Array.from(admins).map(function(a){return a.$get("company")})).then(function(companies){return pickCompanyModal(companies)})}):scope.admin=result},function(err){return loginModal()})};return scope.adminEmail&&scope.adminPassword?tryLogin():loginModal()},scope:{adminEmail:"@",adminPassword:"@",companyId:"@",apiUrl:"@",admin:"="},transclude:!0,template:"<div ng-hide='admin'><img src='/BB_wait.gif' class=\"loader\"></div>\n<div ng-show='admin' ng-transclude></div>"}}),angular.module("BBAdmin.Directives").directive("bbAdminSsoLogin",function($rootScope,BBModel,QueryStringService,halClient){return{restrict:"EA",scope:{token:"@bbAdminSsoLogin",companyId:"@",apiUrl:"@"},transclude:!0,template:"<div ng-if='admin' ng-transclude></div>",link:function(scope,element,attrs){var api_host=void 0;scope.qs=QueryStringService;var data={};scope.qs&&(data.token=scope.qs("sso_token")),scope.token&&(data.token||(data.token=scope.token)),scope.apiUrl&&(api_host=scope.apiUrl),api_host||(api_host=$rootScope.bb.api_url);var url=api_host+"/api/v1/login/admin_sso/"+scope.companyId;return halClient.$post(url,{},data).then(function(login){var params={auth_token:login.auth_token};return login.$get("administrator",params).then(function(admin){return scope.admin=admin,BBModel.Admin.Login.$setLogin(admin)})})}}}),angular.module("BBAdmin").directive("bookingTable",function(BBModel,ModalForm){return{controller:function($scope){return $scope.fields=["id","datetime"],$scope.getBookings=function(){var params={company:$scope.company};return BBModel.Admin.Booking.$query(params).then(function(bookings){return $scope.bookings=bookings.items})},$scope.newBooking=function(){return ModalForm.new({company:$scope.company,title:"New Booking",new_rel:"new_booking",post_rel:"bookings",success:function(booking){return $scope.bookings.push(booking)}})},$scope.edit=function(booking){return ModalForm.edit({model:booking,title:"Edit Booking"})}},link:function(scope,element,attrs){return scope.company?scope.getBookings():BBModel.Admin.Company.$query(attrs).then(function(company){return scope.company=company,scope.getBookings()})},templateUrl:"booking_table_main.html"}}),angular.module("BBAdmin.Directives").directive("bbPeopleList",function($rootScope){return{restrict:"AE",replace:!0,scope:!0,controller:function($scope,$rootScope,PersonService,$q,BBModel,PersonModel){return $rootScope.connection_started.then(function(){return $scope.bb.company.$getPeople().then(function(people){return $scope.people=people,Array.from(people).map(function(person){return person.show=!0})})}),$scope.show_all_people=function(){return Array.from($scope.people).map(function(x){return x.show=!0})},
$scope.hide_all_people=function(){return Array.from($scope.people).map(function(x){return x.show=!1})}},link:function(scope,element,attrs){}}}),angular.module("BBAdmin.Directives").directive("bbBookingList",function(){return{restrict:"AE",replace:!0,scope:{bookings:"=",cancelled:"=",params:"="},templateUrl:function(tElm,tAttrs){return tAttrs.template},controller:function($scope,$filter){$scope.title=$scope.params.title;var status=$scope.params.status;return $scope.$watch(function(){return $scope.bookings},function(){var bookings=$scope.bookings,cancelled=$scope.cancelled;return null==cancelled&&(cancelled=!1),null!=bookings&&(bookings=$filter("filter")(bookings,function(booking){var ret=booking.is_cancelled===cancelled;return ret&=null!=status?booking.hasStatus(status):null==booking.multi_status||0===Object.keys(booking.multi_status).length,ret&=4===booking.status}),$scope.relevantBookings=$filter("orderBy")(bookings,"datetime")),null!=$scope.relevantBookings?$scope.relevantBookings:$scope.relevantBookings=[]})}}}),angular.module("BBAdmin").filter("rag",function(){return function(value,v1,v2){return value<=v1?"red":value<=v2?"amber":"green"}}),angular.module("BBAdmin").filter("gar",function(){return function(value,v1,v2){return value<=v1?"green":value<=v2?"amber":"red"}}),angular.module("BBAdmin").filter("time",function($window){return function(v){return $window.sprintf("%02d:%02d",Math.floor(v/60),v%60)}}),angular.module("BB.Models").factory("AdminAdministratorModel",function($q,BBModel,BaseModel){return function(_BaseModel){function Administrator(){return _classCallCheck(this,Administrator),_possibleConstructorReturn(this,_BaseModel.apply(this,arguments))}return _inherits(Administrator,_BaseModel),Administrator}(BaseModel)}),angular.module("BB.Models").factory("AdminBookingModel",function($q,BBModel,BaseModel,BookingCollections,$window){return function(_BaseModel){function Admin_Booking(data){_classCallCheck(this,Admin_Booking);var _this=_possibleConstructorReturn(this,_BaseModel.apply(this,arguments));if(_this.datetime=moment(_this.datetime),_this.start=_this.datetime,_this.end=_this.end_datetime,_this.end||(_this.end=_this.datetime.clone().add(_this.duration,"minutes")),_this.title=_this.full_describe,_this.time=60*_this.start.hour()+_this.start.minute(),_this.allDay=!1,_this.duration_span&&86400===_this.duration_span&&(_this.allDay=!0),3===_this.status?(_this.startEditable=!0,_this.durationEditable=!0,_this.className="status_blocked"):4===_this.status?_this.className="status_booked":0===_this.status&&(_this.className="status_available"),_this.multi_status)for(var k in _this.multi_status)_this.className+=" status_"+k;return _this}return _inherits(Admin_Booking,_BaseModel),Admin_Booking.prototype.useFullTime=function(){if(this.using_full_time=!0,this.pre_time&&(this.start=this.datetime.clone().subtract(this.pre_time,"minutes")),this.post_time)return this.end=this.datetime.clone().add(this.duration+this.post_time,"minutes")},Admin_Booking.prototype.getPostData=function(){var data={};return this.date&&this.time?(data.date=this.date.date.toISODate(),data.time=this.time.time,this.time.event_id?data.event_id=this.time.event_id:this.time.event_ids&&(data.event_ids=this.time.event_ids)):(this.datetime=this.start.clone(),this.using_full_time&&this.datetime.add(this.pre_time,"minutes"),data.date=this.datetime.format("YYYY-MM-DD"),data.time=60*this.datetime.hour()+this.datetime.minute()),data.duration=this.duration,data.id=this.id,data.pre_time=this.pre_time,data.post_time=this.post_time,data.person_id=this.person_id,data.resource_id=this.resource_id,data.child_client_ids=this.child_client_ids,data.people_ids=this.people_ids,this.questions&&(data.questions=Array.from(this.questions).map(function(q){return q.getPostData()})),data},Admin_Booking.prototype.hasStatus=function(status){return null!=this.multi_status[status]},Admin_Booking.prototype.statusTime=function(status){return this.multi_status[status]?moment(this.multi_status[status]):null},Admin_Booking.prototype.sinceStatus=function(status){var s=this.statusTime(status);return s?Math.floor((moment().unix()-s.unix())/60):0},Admin_Booking.prototype.sinceStart=function(options){var s=void 0,start=this.datetime.unix();return options?options.later&&(s=this.statusTime(options.later).unix())>start?Math.floor((moment().unix()-s)/60):options.earlier&&(s=this.statusTime(options.earlier).unix())<start?Math.floor((moment().unix()-s)/60):Math.floor((moment().unix()-start)/60):Math.floor((moment().unix()-start)/60)},Admin_Booking.prototype.answer=function(q){if(this.answers_summary){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=Array.from(this.answers_summary)[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var a=_step.value;if(a.name===q)return a.answer}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}return null},Admin_Booking.prototype.$update=function(data){var _this2=this,defer=$q.defer();return data&&(data.datetime=moment(data.datetime),data.datetime.tz(),data.datetime=data.datetime.format()),data||(data=this.getPostData()),this.$put("self",{},data).then(function(res){return _this2.constructor(res),_this2.using_full_time&&_this2.useFullTime(),BookingCollections.checkItems(_this2),defer.resolve(_this2)},function(err){return defer.reject(err)}),defer.promise},Admin_Booking.prototype.$refetch=function(){var _this3=this,defer=$q.defer();return this.$flush("self"),this.$get("self").then(function(res){return _this3.constructor(res),_this3.using_full_time&&_this3.useFullTime(),BookingCollections.checkItems(_this3),defer.resolve(_this3)},function(err){return defer.reject(err)}),defer.promise},Admin_Booking.$query=function(params){var company=void 0;params.slot&&(params.slot_id=params.slot.id),params.date&&(params.start_date=params.date,params.end_date=params.date),params.company&&(company=params.company,delete params.company,params.company_id=company.id),null==params.per_page&&(params.per_page=1024),null==params.include_cancelled&&(params.include_cancelled=!1);var defer=$q.defer(),existing=BookingCollections.find(params);if(existing&&!params.skip_cache)defer.resolve(existing);else{var src=company;src||(src=params.src),params.src&&delete params.src,params.skip_cache&&(existing&&BookingCollections.delete(existing),src.$flush("bookings",params)),src.$get("bookings",params).then(function(resource){if(resource.$has("bookings"))return resource.$get("bookings").then(function(bookings){var models=Array.from(bookings).map(function(b){return new BBModel.Admin.Booking(b)}),spaces=new $window.Collection.Booking(resource,models,params);return BookingCollections.add(spaces),defer.resolve(spaces)},function(err){return defer.reject(err)});var booking=new BBModel.Admin.Booking(resource);return defer.resolve(booking)},function(err){return defer.reject(err)})}return defer.promise},Admin_Booking}(BaseModel)}),angular.module("BB.Models").factory("AdminClientModel",function(ClientModel,$q,BBModel,$log,$window,ClientCollections,$rootScope,UriTemplate,halClient){return function(_ClientModel){function Admin_Client(data){return _classCallCheck(this,Admin_Client),_possibleConstructorReturn(this,_ClientModel.call(this,data))}return _inherits(Admin_Client,_ClientModel),Admin_Client.$query=function(params){var company=params.company,defer=$q.defer();if(company.$has("client")){var url="";$rootScope.bb.api_url&&(url=$rootScope.bb.api_url);var href=url+"/api/v1/admin/{company_id}/client{/id}{?page,per_page,filter_by,filter_by_fields,order_by,order_by_reverse,search_by_fields,default_company_id}";params.company_id=company.id;var uri=new UriTemplate(href).fillFromObject(params||{});params.flush&&halClient.clearCache(uri),halClient.$get(uri,{}).then(function(resource){if(resource.$has("clients"))return resource.$get("clients").then(function(clients){var models=Array.from(clients).map(function(c){return new BBModel.Admin.Client(c)});return clients=new $window.Collection.Client(resource,models,params),clients.total_entries=resource.total_entries,ClientCollections.add(clients),defer.resolve(clients)},function(err){return defer.reject(err)});var client=new BBModel.Admin.Client(resource);return defer.resolve(client)},function(err){return defer.reject(err)})}else $log.warn("company has no client link"),defer.reject("company has no client link");return defer.promise},Admin_Client}(ClientModel)}),angular.module("BB.Models").factory("AdminCompanyModel",function(CompanyModel,AdminCompanyService,BookingCollections,$q,BBModel){return function(_CompanyModel){function Admin_Company(data){return _classCallCheck(this,Admin_Company),_possibleConstructorReturn(this,_CompanyModel.call(this,data))}return _inherits(Admin_Company,_CompanyModel),Admin_Company.prototype.getBooking=function(id){var defer=$q.defer();return this.$get("bookings",{id:id}).then(function(booking){var model=new BBModel.Admin.Booking(booking);return BookingCollections.checkItems(model),defer.resolve(model)},function(err){return defer.reject(err)}),defer.promise},Admin_Company.$query=function(params){return AdminCompanyService.query(params)},Admin_Company}(CompanyModel)}),angular.module("BB.Models").factory("AdminLoginModel",function($q,AdminLoginService,BBModel,BaseModel){return function(_BaseModel){function Admin_Login(data){return _classCallCheck(this,Admin_Login),_possibleConstructorReturn(this,_BaseModel.call(this,data))}return _inherits(Admin_Login,_BaseModel),Admin_Login.$login=function(form,options){return AdminLoginService.login(form,options)},Admin_Login.$ssoLogin=function(options,data){return AdminLoginService.ssoLogin(options,data)},Admin_Login.$isLoggedIn=function(){return AdminLoginService.isLoggedIn()},Admin_Login.$setLogin=function(user){return AdminLoginService.setLogin(user)},Admin_Login.$user=function(){return AdminLoginService.user()},Admin_Login.$checkLogin=function(params){return AdminLoginService.checkLogin(params)},Admin_Login.$logout=function(){return AdminLoginService.logout()},Admin_Login.$getLogin=function(options){return AdminLoginService.getLogin(options)},Admin_Login.$companyLogin=function(company,params){return AdminLoginService.companyLogin(company,params)},Admin_Login.$memberQuery=function(params){return AdminLoginService.memberQuery(params)},Admin_Login.$setCompany=function(company_id){return AdminLoginService.setCompany(company_id)},Admin_Login}(BaseModel)}),angular.module("BB.Models").factory("AdminSlotModel",function($q,BBModel,BaseModel,TimeSlotModel,SlotCollections,$window){return function(_TimeSlotModel){function Admin_Slot(data){_classCallCheck(this,Admin_Slot);var _this=_possibleConstructorReturn(this,_TimeSlotModel.call(this,data));if(_this.title=_this.full_describe,0===_this.status&&(_this.title="Available"),_this.datetime=moment(_this.datetime),_this.start=_this.datetime,_this.end=_this.end_datetime,_this.end=_this.datetime.clone().add(_this.duration,"minutes"),_this.time=60*_this.start.hour()+_this.start.minute(),_this.title=_this.full_describe,_this.allDay=!1,_this.duration_span&&86400===_this.duration_span&&(_this.allDay=!0),3===_this.status?(_this.startEditable=!0,_this.durationEditable=!0,_this.className="status_blocked"):4===_this.status?_this.className="status_booked":0===_this.status&&(_this.className="status_available"),_this.multi_status)for(var k in _this.multi_status)_this.className+=" status_"+k;return _this}return _inherits(Admin_Slot,_TimeSlotModel),Admin_Slot.prototype.useFullTime=function(){if(this.using_full_time=!0,this.pre_time&&(this.start=this.datetime.clone().subtract(this.pre_time,"minutes")),this.post_time)return this.end=this.datetime.clone().add(this.duration+this.post_time,"minutes")},Admin_Slot.prototype.$refetch=function(){var _this2=this,defer=$q.defer();return this.$flush("self"),this.$get("self").then(function(res){return _this2.constructor(res),_this2.using_full_time&&_this2.useFullTime(),BookingCollections.checkItems(_this2),defer.resolve(_this2)},function(err){return defer.reject(err)}),defer.promise},Admin_Slot.$query=function(params){var company=void 0;params.slot&&(params.slot_id=params.slot.id),params.date&&(params.start_date=params.date,params.end_date=params.date),params.company&&(company=params.company,delete params.company,params.company_id=company.id),null==params.per_page&&(params.per_page=1024),null==params.include_cancelled&&(params.include_cancelled=!1);var defer=$q.defer(),existing=SlotCollections.find(params);if(existing&&!params.skip_cache)defer.resolve(existing);else{var src=company;src||(src=params.src),params.src&&delete params.src,params.skip_cache&&(existing&&SlotCollections.delete(existing),src.$flush("slots",params)),src.$get("slots",params).then(function(resource){if(resource.$has("slots"))return resource.$get("slots").then(function(slots){var models=Array.from(slots).map(function(b){return new BBModel.Admin.Slot(b)}),spaces=new $window.Collection.Slot(resource,models,params);return SlotCollections.add(spaces),defer.resolve(spaces)},function(err){return defer.reject(err)});var slot=new BBModel.Admin.Slot(resource);return defer.resolve(slot)},function(err){return defer.reject(err)})}return defer.promise},Admin_Slot}(TimeSlotModel)}),angular.module("BB.Models").factory("AdminUserModel",function($q,BBModel,BaseModel){return function(_BaseModel){function User(){return _classCallCheck(this,User),_possibleConstructorReturn(this,_BaseModel.apply(this,arguments))}return _inherits(User,_BaseModel),User}(BaseModel)}),angular.module("BBAdmin.Services").factory("AdminBookingService",function($q,$window,halClient,BookingCollections,BBModel,UriTemplate){return{query:function(prms){var company=void 0;prms.slot&&(prms.slot_id=prms.slot.id),prms.date&&(prms.start_date=prms.date,prms.end_date=prms.date),prms.company&&(company=prms.company,delete prms.company,prms.company_id=company.id),null==prms.per_page&&(prms.per_page=1024),null==prms.include_cancelled&&(prms.include_cancelled=!1);var deferred=$q.defer(),existing=BookingCollections.find(prms);if(existing&&!prms.skip_cache)deferred.resolve(existing);else if(company)prms.skip_cache&&(existing&&BookingCollections.delete(existing),company.$flush("bookings",prms)),company.$get("bookings",prms).then(function(collection){return collection.$get("bookings").then(function(bookings){var models=Array.from(bookings).map(function(b){return new BBModel.Admin.Booking(b)}),spaces=new $window.Collection.Booking(collection,models,prms);return BookingCollections.add(spaces),deferred.resolve(spaces)},function(err){return deferred.reject(err)})},function(err){return deferred.reject(err)});else{var url="";prms.url&&(url=prms.url);var href=url+"/api/v1/admin/{company_id}/bookings{?slot_id,start_date,end_date,service_id,resource_id,person_id,page,per_page,include_cancelled,embed,client_id}",uri=new UriTemplate(href).fillFromObject(prms||{});halClient.$get(uri,{}).then(function(found){return found.$get("bookings").then(function(items){var sitems=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=Array.from(items)[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var item=_step.value;sitems.push(new BBModel.Admin.Booking(item))}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}var spaces=new $window.Collection.Booking(found,sitems,prms);return BookingCollections.add(spaces),deferred.resolve(spaces)})},function(err){return deferred.reject(err)})}return deferred.promise},getBooking:function(prms){var deferred=$q.defer();prms.company&&!prms.company_id&&(prms.company_id=prms.company.id);var url="";prms.url&&(url=prms.url);var href=url+"/api/v1/admin/{company_id}/bookings/{id}{?embed}",uri=new UriTemplate(href).fillFromObject(prms||{});return halClient.$get(uri,{no_cache:!0}).then(function(item){var booking=new BBModel.Admin.Booking(item);return BookingCollections.checkItems(booking),deferred.resolve(booking)},function(err){return deferred.reject(err)}),deferred.promise},cancelBooking:function(prms,booking){var deferred=$q.defer();null==prms.id&&(prms.id=booking.id);var notify=prms.notify;null==notify&&(notify=!0);var uri=new UriTemplate("/api/v1/admin/{company_id}/bookings/{id}?notify={notify}").fillFromObject(prms||{});return halClient.$del(uri,{notify:notify}).then(function(item){return booking=new BBModel.Admin.Booking(item),BookingCollections.checkItems(booking),deferred.resolve(booking)},function(err){return deferred.reject(err)}),deferred.promise},updateBooking:function(prms,booking){var deferred=$q.defer();null==prms.id&&(prms.id=booking.id);var uri=new UriTemplate("/api/v1/admin/{company_id}/bookings/{id}").fillFromObject(prms||{});return halClient.$put(uri,{},prms).then(function(item){return booking=new BBModel.Admin.Booking(item),BookingCollections.checkItems(booking),deferred.resolve(booking)},function(err){return deferred.reject(err)}),deferred.promise},blockTimeForPerson:function(prms,person){var deferred=$q.defer();null==prms.person_id&&(prms.person_id=person.id),prms.booking=!0;var uri=new UriTemplate("/api/v1/admin/{company_id}/people/{person_id}/block").fillFromObject(prms||{});return halClient.$put(uri,{},prms).then(function(item){var booking=new BBModel.Admin.Booking(item);return BookingCollections.checkItems(booking),deferred.resolve(booking)},function(err){return deferred.reject(err)}),deferred.promise},addStatusToBooking:function(prms,booking,status){var deferred=$q.defer();null==prms.booking_id&&(prms.booking_id=booking.id);var uri=new UriTemplate("/api/v1/admin/{company_id}/bookings/{booking_id}/multi_status").fillFromObject(prms||{});return halClient.$put(uri,{},{status:status}).then(function(item){return booking=new BBModel.Admin.Booking(item),BookingCollections.checkItems(booking),deferred.resolve(booking)},function(err){return deferred.reject(err)}),deferred.promise},addPrivateNoteToBooking:function(prms,booking,note){var noteParam=void 0,deferred=$q.defer();null==prms.booking_id&&(prms.booking_id=booking.id),null!=note.note&&(noteParam=note.note),null==noteParam&&(noteParam=note);var uri=new UriTemplate("/api/v1/admin/{company_id}/bookings/{booking_id}/private_notes").fillFromObject(prms||{});return halClient.$put(uri,{},{note:noteParam}).then(function(item){return booking=new BBModel.Admin.Booking(item),BookingCollections.checkItems(booking),deferred.resolve(booking)},function(err){return deferred.reject(err)}),deferred.promise},updatePrivateNoteForBooking:function(prms,booking,note){var deferred=$q.defer();null==prms.booking_id&&(prms.booking_id=booking.id),null==prms.id&&(prms.id=note.id);var uri=new UriTemplate("/api/v1/admin/{company_id}/bookings/{booking_id}/private_notes/{id}").fillFromObject(prms||{});return halClient.$put(uri,{},{note:note.note}).then(function(item){return booking=new BBModel.Admin.Booking(item),BookingCollections.checkItems(booking),deferred.resolve(booking)},function(err){return deferred.reject(err)}),deferred.promise},deletePrivateNoteFromBooking:function(prms,booking,note){var deferred=$q.defer();null==prms.booking_id&&(prms.booking_id=booking.id),null==prms.id&&(prms.id=note.id);var uri=new UriTemplate("/api/v1/admin/{company_id}/bookings/{booking_id}/private_notes/{id}").fillFromObject(prms||{});return halClient.$del(uri,{}).then(function(item){return booking=new BBModel.Admin.Booking(item),BookingCollections.checkItems(booking),deferred.resolve(booking)},function(err){return deferred.reject(err)}),deferred.promise}}}),angular.module("BBAdmin.Services").factory("ColorPalette",function(){var colors=[{primary:"#001F3F",secondary:"#80BFFF"},{primary:"#FF4136",secondary:"#800600"},{primary:"#7FDBFF",secondary:"#004966"},{primary:"#3D9970",secondary:"#163728"},{primary:"#85144B",secondary:"#EB7AB1"},{primary:"#2ECC40",secondary:"#0E3E14"},{primary:"#FF851B",secondary:"#663000"}];return{setColors:function(models){return _.each(models,function(model,i){var color=colors[i%colors.length];return model.color=color.primary,model.textColor=color.secondary})}}}),angular.module("BBAdmin.Services").factory("AdminCompanyService",function($q,$rootScope,$sessionStorage,BBModel){return{query:function(params){var defer=$q.defer();return $rootScope.bb||($rootScope.bb={}),$rootScope.bb.api_url||($rootScope.bb.api_url=$sessionStorage.getItem("host")),$rootScope.bb.api_url||($rootScope.bb.api_url=params.apiUrl),$rootScope.bb.api_url||($rootScope.bb.api_url=""),BBModel.Admin.Login.$checkLogin(params).then(function(){if($rootScope.user&&$rootScope.user.company_id)return $rootScope.bb||($rootScope.bb={}),$rootScope.bb.company_id=$rootScope.user.company_id,$rootScope.user.$get("company").then(function(company){return defer.resolve(new BBModel.Admin.Company(company))},function(err){return defer.reject(err)});var login_form={email:params.adminEmail,password:params.adminPassword},options={company_id:params.companyId};return BBModel.Admin.Login.$login(login_form,options).then(function(user){return user.$get("company").then(function(company){return defer.resolve(new BBModel.Admin.Company(company))},function(err){return defer.reject(err)})},function(err){return defer.reject(err)})}),defer.promise}}});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};angular.module("BBAdmin.Services").factory("AdminDayService",function($q,$window,halClient,BBModel,UriTemplate){return{query:function(prms){var url="";prms.url&&(url=prms.url);var href=url+"/api/v1/{company_id}/day_data{?month,week,date,edate,event_id,service_id}",uri=new UriTemplate(href).fillFromObject(prms||{}),deferred=$q.defer();return halClient.$get(uri,{}).then(function(found){if(found.items){var _ret=function(){var mdays=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=Array.from(found.items)[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var item=_step.value;halClient.$get(item.uri).then(function(data){var days=[],_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=Array.from(data.days)[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var i=_step2.value;i.type===prms.item&&days.push(new BBModel.Day(i))}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}var dcol=new $window.Collection.Day(data,days,{});return mdays.push(dcol)})}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return{v:deferred.resolve(mdays)}}();if("object"===(void 0===_ret?"undefined":_typeof(_ret)))return _ret.v}},function(err){return deferred.reject(err)}),deferred.promise}}}),angular.module("BBAdmin.Services").factory("AdminLoginService",function($q,halClient,$rootScope,BBModel,$sessionStorage,$cookies,UriTemplate,shared_header){return{login:function(form,options){var _this=this,login_model=void 0,deferred=$q.defer(),url=$rootScope.bb.api_url+"/api/v1/login/admin";return null!=options&&null!=options.company_id&&(url=url+"/"+options.company_id),halClient.$post(url,options,form).then(function(login){return login.$has("administrator")?login.$get("administrator").then(function(user){return user=_this.setLogin(user),deferred.resolve(user)}):login.$has("administrators")?(login_model=new BBModel.Admin.Login(login),deferred.resolve(login_model)):deferred.reject("No admin account for login")},function(err){if(400===err.status){var login=halClient.$parse(err.data);return login.$has("administrators")?(login_model=new BBModel.Admin.Login(login),deferred.resolve(login_model)):deferred.reject(err)}return deferred.reject(err)}),deferred.promise},ssoLogin:function(options,data){var _this2=this,deferred=$q.defer(),url=$rootScope.bb.api_url+"/api/v1/login/sso/"+options.company_id;return halClient.$post(url,{},data).then(function(login){return login.$get("user").then(function(user){return user=_this2.setLogin(user),deferred.resolve(user)})},function(err){return deferred.reject(err)}),deferred.promise},isLoggedIn:function(){var deferred=$q.defer();return this.checkLogin().then(function(){return $rootScope.user?deferred.resolve(!0):deferred.reject(!1)},function(err){return deferred.reject(!1)}),deferred.promise},setLogin:function(user){user=new BBModel.Admin.User(user);var auth_token=user.getOption("auth_token");return $sessionStorage.setItem("user",user.$toStore()),$sessionStorage.setItem("auth_token",auth_token),$rootScope.user=user,user},user:function(){return this.checkLogin().then(function(){return $rootScope.user})},checkLogin:function(params){null==params&&(params={});var defer=$q.defer();$rootScope.user&&defer.resolve();var user=$sessionStorage.getItem("user");if(user)$rootScope.user=new BBModel.Admin.User(halClient.createResource(user)),defer.resolve();else{var auth_token=$cookies.get("Auth-Token");if(auth_token){var url=void 0;url=$rootScope.bb.api_url?$rootScope.bb.api_url+"/api/v1/login{?id,role}":"/api/v1/login{?id,role}",params.id=params.companyId||params.company_id,params.role="admin";var href=new UriTemplate(url).fillFromObject(params||{}),options={auth_token:auth_token};halClient.$get(href,options).then(function(login){return login.$has("administrator")?login.$get("administrator").then(function(user){return $rootScope.user=new BBModel.Admin.User(user),defer.resolve()}):defer.resolve()},function(){return defer.resolve()})}else defer.resolve()}return defer.promise},logout:function(){var defer=$q.defer(),url=$rootScope.bb.api_url+"/api/v1/login";return halClient.$del(url).finally(function(){return $rootScope.user=null,$sessionStorage.removeItem("user"),$sessionStorage.removeItem("auth_token"),$cookies.remove("Auth-Token"),shared_header.del("auth_token"),defer.resolve()},function(){return defer.reject()}),defer.promise},getLogin:function(options){var _this3=this,defer=$q.defer(),url=$rootScope.bb.api_url+"/api/v1/login/admin/"+options.company_id;return halClient.$get(url,options).then(function(login){return login.$has("administrator")?login.$get("administrator").then(function(user){return user=_this3.setLogin(user),defer.resolve(user)},function(err){return defer.reject(err)}):defer.reject()},function(err){return defer.reject(err)}),defer.promise},setCompany:function(company_id){var _this4=this,defer=$q.defer(),url=$rootScope.bb.api_url+"/api/v1/login/admin",params={company_id:company_id};return halClient.$put(url,{},params).then(function(login){return login.$has("administrator")?login.$get("administrator").then(function(user){return user=_this4.setLogin(user),defer.resolve(user)},function(err){return defer.reject(err)}):defer.reject()},function(err){return defer.reject(err)}),defer.promise}}}),angular.module("BBAdmin.Services").factory("AdminPurchaseService",function($q,halClient,BBModel){return{query:function(params){var defer=$q.defer(),uri=params.url_root+"/api/v1/admin/purchases/"+params.purchase_id;return halClient.$get(uri,params).then(function(purchase){return purchase=new BBModel.Purchase.Total(purchase),defer.resolve(purchase)},function(err){return defer.reject(err)}),defer.promise},markAsPaid:function(params){var company_id=void 0,defer=$q.defer();if(!params.purchase||!params.url_root)return defer.reject("invalid request"),defer.promise;params.company&&(company_id=params.company.id);var uri=params.url_root+"/api/v1/admin/"+company_id+"/purchases/"+params.purchase.id+"/pay",data={};return params.company&&(data.company_id=params.company.id),params.notify_admin&&(data.notify_admin=params.notify_admin),params.payment_status&&(data.payment_status=params.payment_status),params.amount&&(data.amount=params.amount),params.notes&&(data.notes=params.notes),params.transaction_id&&(data.transaction_id=params.transaction_id),params.notify&&(data.notify=params.notify),params.payment_type&&(data.payment_type=params.payment_type),halClient.$put(uri,params,data).then(function(purchase){return purchase=new BBModel.Purchase.Total(purchase),defer.resolve(purchase)},function(err){return defer.reject(err)}),defer.promise}}}),angular.module("BBAdmin.Services").factory("AdminSlotService",function($q,$window,halClient,SlotCollections,BBModel,UriTemplate){return{query:function(prms){var deferred=$q.defer(),existing=SlotCollections.find(prms);if(existing)deferred.resolve(existing);else if(prms.user)prms.user.$get("company").then(function(company){return company.$get("slots",prms).then(function(slots_collection){return slots_collection.$get("slots").then(function(slots){var slot_models=Array.from(slots).map(function(s){return new BBModel.Admin.Slot(s)});return deferred.resolve(slot_models)},function(err){return deferred.reject(err)})})});else{var url="";prms.url&&(url=prms.url);var href=url+"/api/v1/admin/{company_id}/slots{?start_date,end_date,date,service_id,resource_id,person_id,page,per_page}",uri=new UriTemplate(href).fillFromObject(prms||{});halClient.$get(uri,{}).then(function(found){return found.$get("slots").then(function(items){var sitems=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=Array.from(items)[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var item=_step.value;sitems.push(new BBModel.Admin.Slot(item))}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}var slots=new $window.Collection.Slot(found,sitems,prms);return SlotCollections.add(slots),deferred.resolve(slots)})},function(err){return deferred.reject(err)})}return deferred.promise},create:function(prms,data){var url="";prms.url&&(url=prms.url);var href=url+"/api/v1/admin/{company_id}/slots",uri=new UriTemplate(href).fillFromObject(prms||{}),deferred=$q.defer();return halClient.$post(uri,{},data).then(function(slot){return slot=new BBModel.Admin.Slot(slot),SlotCollections.checkItems(slot),deferred.resolve(slot)},function(err){return deferred.reject(err)}),deferred.promise},delete:function(item){var deferred=$q.defer();return item.$del("self").then(function(slot){return slot=new BBModel.Admin.Slot(slot),SlotCollections.deleteItems(slot),deferred.resolve(slot)},function(err){return deferred.reject(err)}),deferred.promise},update:function(item,data){var deferred=$q.defer();return item.$put("self",{},data).then(function(slot){return slot=new BBModel.Admin.Slot(slot),SlotCollections.checkItems(slot),deferred.resolve(slot)},function(err){return deferred.reject(err)}),deferred.promise}}}),angular.module("BBAdmin.Services").factory("AdminTimeService",function($q,$window,halClient,BBModel,UriTemplate){return{query:function(prms){prms.day&&(prms.date=prms.day.date),!prms.edate&&prms.date&&(prms.edate=prms.date);var url="";prms.url&&(url=prms.url);var href=url+"/api/v1/{company_id}/time_data{?date,event_id,service_id,person_id}",uri=new UriTemplate(href).fillFromObject(prms||{}),deferred=$q.defer();return halClient.$get(uri,{no_cache:!1}).then(function(found){return found.$get("events").then(function(events){var eventItems=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=Array.from(events)[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){
var eventItem=_step.value,event={};event.times=[],event.event_id=eventItem.event_id,event.person_id=found.person_id;var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=Array.from(eventItem.times)[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var time=_step2.value,ts=new BBModel.TimeSlot(time);event.times.push(ts)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}eventItems.push(event)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return deferred.resolve(eventItems)})},function(err){return deferred.reject(err)}),deferred.promise}}}),angular.module("BB.Services").factory("BB.Service.login",function($q,BBModel){return{unwrap:function(resource){return new BBModel.Admin.Login(resource)}}}),angular.module("BB.Services").factory("BB.Service.base_login",function($q,BBModel){return{unwrap:function(resource){return new BBModel.Admin.Login(resource)}}}),angular.module("BBAdmin").config(function($translateProvider){"ngInject";var translations={ADMIN:{CANCEL_BOOKING_MODAL:{TITLE:"Cancel Booking",REASON_LBL:"Cancel reason",SEND_EMAIL_LBL:"Send cancellation confirmation to {{email}}?",OK_BTN:"@:COMMON.BTN.OK",CLOSE_BTN:"@:COMMON.BTN.CLOSE"},LOGIN:{EMAIL_LBL:"@:COMMON.TERMINOLOGY.EMAIL",EMAIL_PLACEHOLDER:"@:COMMON.TERMINOLOGY.EMAIL",PASSWORD_LBL:"@:COMMON.FORM.PASSWORD",PASSWORD_PLACEHOLDER:"@:COMMON.FORM.PASSWORD",LOGIN_BTN:"@:COMMON.BTN.LOGIN"},PICK_COMPANY:{STEP_SUMMARY:"Pick Company",SELECT_BTN:"@:COMMON.BTN.SELECT"},BOOKNG_TABLE:{NEW_BOOKING_BTN:"New booking",EDIT_BTN:"@:COMMON.BTN.EDIT"}}};$translateProvider.translations("en",translations)});